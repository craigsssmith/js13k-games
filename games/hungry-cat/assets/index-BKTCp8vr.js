(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))s(o);new MutationObserver(o=>{for(const n of o)if(n.type==="childList")for(const m of n.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&s(m)}).observe(document,{childList:!0,subtree:!0});function e(o){const n={};return o.integrity&&(n.integrity=o.integrity),o.referrerPolicy&&(n.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?n.credentials="include":o.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(o){if(o.ep)return;o.ep=!0;const n=e(o);fetch(o.href,n)}})();class R{stateMachine;children=[];constructor(t){this.stateMachine=t}}const u=window.innerWidth,p=window.innerHeight,r={x:Math.floor(u/2),y:Math.floor(p/2)},V="#333333",d={START_MENU:"START_MENU",WORLD:"WORLD",LOADING:"LOADING",END_SCREEN:"END_SCREEN"},b=32,G=Math.floor(b/1.25),S=40;class K extends R{update(){}render(t){t.fillStyle="white",t.fillRect(r.x-100,r.y-100,200,200)}cleanup(){}}const z=new Set,E=new Set,h={SPACE:"Space",W:"KeyW",A:"KeyA",S:"KeyS",D:"KeyD",LEFT:"ArrowLeft",RIGHT:"ArrowRight",DOWN:"ArrowDown",UP:"ArrowUp"},l=i=>z.has(i),q=i=>E.has(i)?(E.delete(i),!0):!1;document.addEventListener("keydown",i=>{z.has(i.code)||E.add(i.code),z.add(i.code)});document.addEventListener("keyup",i=>{z.delete(i.code),E.delete(i.code)});class f{static instance;assets=new Map;constructor(){}static getInstance(){return f.instance||(f.instance=new f),f.instance}loadImage(t,e){return new Promise((s,o)=>{const n=new Image;n.src=e,n.onload=()=>{this.assets.set(t,n),s(n)},n.onerror=()=>o(`Error loading image: ${e}`)})}async loadAll(t){const e=[];for(const[s,o]of Object.entries(t))e.push(this.loadImage(s,o));await Promise.all(e)}get(t){const e=this.assets.get(t);if(!e)throw new Error(`Resource '${t}' has not been found.`);return e}}class H{position={x:0,y:0};velocity={x:1,y:1};rotation=0;angularVelocity=.5;sprite;size=128;isOld=!1;timerId;constructor(t,e){this.sprite=f.getInstance().get("asteroid"),this.position=t,this.velocity=e,this.timerId=setTimeout(()=>{this.isOld=!1,clearTimeout(this.timerId)},1e4)}update(t){this.rotation+=this.angularVelocity*t,this.position.x+=this.velocity.x*t,this.position.y+=this.velocity.y*t,this.velocity.x,this.velocity.y}render(t){const e=this.size/2;t.save(),t.translate(Math.floor(this.position.x+e),Math.floor(this.position.y+e)),t.rotate(this.rotation),t.drawImage(this.sprite,0,0,32,32,Math.floor(-e),Math.floor(-e),this.size,this.size),t.restore()}}const Z=i=>{i.fillStyle=V,i.fillRect(0,0,u,p)},Q=i=>i.length*G,O=(i,t,e)=>i+(t-i)*e,B=(i,t)=>Math.floor(Math.random()*(t-i+1))+i,X=i=>i==="left"?{x:-S,y:r.y}:i==="right"?{x:u+S,y:r.y}:i==="bottom"?{x:r.x,y:p+S}:{x:r.x,y:-S},P=(i,t=1)=>{const e=()=>(Math.random()-.5)*10,s={x:1,y:1};i==="left"?s.y=e():i==="right"?(s.x=-1,s.y=e()):i==="bottom"?(s.x=e(),s.y=-1):(s.x=e(),s.y=1);const o=Math.sqrt(s.x**2+s.y**2);return s.x=s.x/o*t,s.y=s.y/o*t,s},j=(i,t)=>{const e=i.size/4,s=t instanceof H?t.size/4:t.size/2;return!(i.position.x+e<t.position.x-s||i.position.x-e>t.position.x+s||i.position.y+e<t.position.y-s||i.position.y-e>t.position.y+s)},tt=i=>i.position.x+i.size<0||i.position.x>u||i.position.y+i.size<0||i.position.y>p,et=i=>{switch(i){case"fish":return 2;case"cheese":return 3;case"donut":return 4;case"susha":return 5;case"coffee":return 6;case"watermelon":return 7}};class N{stars=[];numStars=300;constructor(){this.generate()}generate(){this.stars=[];for(let t=0;t<this.numStars;t++)this.stars.push({x:Math.floor(Math.random()*u),y:Math.floor(Math.random()*p),brightness:Math.random()*.3+.2,size:[4,8,12][B(0,2)],pulse:(Math.random()-.5)*.3})}update(t){for(const e of this.stars)e.brightness+=e.pulse*t,e.brightness>1?(e.brightness=1,e.pulse*=-1):e.brightness<.2&&(e.brightness=.2,e.pulse*=-1)}render(t){t.fillStyle=V;for(const e of this.stars){const s=Math.floor(255*e.brightness);t.fillStyle=`rgb(${s}, ${s}, ${s})`,t.fillRect(e.x,e.y,e.size,e.size)}}cleanup(){}}const I={},g=8,D="abcdefghijklm",st="nopqrstuvwxyz",it="1234567890-+!";for(let i=0;i<D.length;i++)I[D[i]]={x:i*g,y:0},I[st[i]]={x:i*g,y:g},I[it[i]]={x:i*g,y:g*2};const ot=(i,t,e,s,o=b)=>{for(let n=0;n<t.length;n++){const m=t[n],M=I[m];M&&i.drawImage(f.getInstance().get("alfabet"),M.x,M.y,g,g,e+n*G,s,o,o)}};class c{width;size;text;position;constructor(t="",e={x:0,y:0},s=b){this.text=t,this.size=s,this.width=Q(t),this.position={x:e.x-this.width/2,y:e.y-b/2}}update(){}render(t){ot(t,this.text,this.position.x,this.position.y,this.size)}cleanup(){}}const nt=[[[.4,0,400,,,,,,.5,.1,10,.03,,.2,-.1,,,,,.01]],[[[,,5,5,6,6,,,,,5,5,6,6,,,,,5,5,6,6,,,,,5,5,6,6,,,,,5,5,6,6,,,,,5,5,6,6,,,,,5,5,6,6,,,,,5,5,6,6,,,,,],[,,,,,,,,,,,,,,,,,,26,25,,,26,25,,,26,25,,,26,25,,,26,25,,,26,25,,,26,25,,,26,25,,,26,25,,,26,25,,,,,,,,,,,],[,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,17,17,17,,18,18,20,21,,,19,18,17,,,17,17,17,,18,18,20,21,,,19,18,17,,,,,,,,,],[,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,2,3,1,,,,,,,1,2,3,1,,,,,,,1,2,3,1,,,,,,,,,,,]]],[0],100];class a{static effects={power:[2.3,,455,.02,.02,,1,3.9,-18,-33,,,,.4,,.3,.18,.69,.09],food:[.9,,220,.01,.08,.06,1,.3,-.9,.02,40,,,,,.06,.6,8,,],death:[.95,,180,.01,.28,.12,1,.18,-.7,.12,60,,,,,.08,.8,6,,],start:[2,,43,.15,.03,.05,1,2,5,,,,,.7,,,.14,.76,.04,.44],bounce:[,,667,,.1,.08,,1.7,,-3,,,,,,,,.87,.04]};static node;static play(t){window.zzfx(...a.effects[t])}static music(){const t=window.zzfxM(...nt);a.node=window.zzfxP(...t),a.node.loop=!0}static stopMusic(){a.node?.stop(),a.node?.disconnect()}}class rt extends R{constructor(t){super(t);const e=new N,s=new c("hungry cat",{...r,y:r.y-300},40),o=new c("space is stuffed with snacks",{...r,y:r.y-200},24),n=new c("you have been chosen as most hungry cat to help",{...r,y:r.y-150},24),m=new c("if you do not make it back we will eat in your honor",{...r,y:r.y-100},24),M=new c("!press space to start!",{...r,y:r.y+100},32),Y=new c("wasd to control",{...r,y:r.y+200},24);this.children.push(e,s,o,n,m,M,Y)}cleanup(){}update(){q(h.SPACE)&&(this.stateMachine.changeState(d.WORLD),a.play("start"))}render(t){for(let e of this.children)e.render(t)}}let y=[];const at=()=>{y=y.filter(i=>!(i.isOld&&tt(i)))};let v=0;const ht=i=>v+=i,ct=()=>{v=0,y=[]},lt=i=>{y=y.filter(t=>t!==i)};class ft{pool;head=0;opts;emitAccumulator=0;anchorPos={x:0,y:0};anchorRot=0;activeRate=0;constructor(t={}){this.opts={max:t.max??200,rate:t.rate??120,baseSpeed:t.baseSpeed??160,speedJitter:t.speedJitter??60,spread:t.spread??Math.PI/10,size:t.size??3,life:t.life??.35,drag:t.drag??.92,trickleRate:t.trickleRate??15,startColor:t.startColor??[0,0,0],endColor:t.endColor??[255,255,255]},this.pool=new Array(this.opts.max).fill(0).map(()=>({p:{x:0,y:0},v:{x:0,y:0},life:0,max:0,size:this.opts.size,r:this.opts.startColor[0],g:this.opts.startColor[1],b:this.opts.startColor[2],a:0,sr:this.opts.startColor[0],sg:this.opts.startColor[1],sb:this.opts.startColor[2],er:this.opts.endColor[0],eg:this.opts.endColor[1],eb:this.opts.endColor[2],alive:!1}))}anchorTo(t,e,s){this.anchorRot=e,this.anchorPos.x=t.x-Math.cos(e)*s,this.anchorPos.y=t.y-Math.sin(e)*s}setThrottle(t){this.activeRate=t>0?this.opts.rate*t:this.opts.trickleRate}spawnOne(){const t=this.pool[this.head++];this.head%=this.pool.length;const e=this.anchorRot+Math.PI+(Math.random()-.5)*this.opts.spread,s=this.opts.baseSpeed+(Math.random()*2-1)*this.opts.speedJitter;t.p.x=this.anchorPos.x,t.p.y=this.anchorPos.y,t.v.x=Math.cos(e)*s,t.v.y=Math.sin(e)*s,t.max=this.opts.life*(.85+Math.random()*.3),t.life=t.max,t.size=Math.max(1,this.opts.size+(Math.random()*2-1|0)),t.sr=this.opts.startColor[0],t.sg=this.opts.startColor[1],t.sb=this.opts.startColor[2],t.er=this.opts.endColor[0],t.eg=this.opts.endColor[1],t.eb=this.opts.endColor[2],t.r=t.sr,t.g=t.sg,t.b=t.sb,t.a=1,t.alive=!0}update(t){for(this.emitAccumulator+=this.activeRate*t;this.emitAccumulator>=1;)this.spawnOne(),this.emitAccumulator-=1;for(let e=0;e<this.pool.length;e++){const s=this.pool[e];if(!s.alive)continue;if(s.p.x+=s.v.x*t,s.p.y+=s.v.y*t,s.life-=t,s.life<=0){s.alive=!1;continue}const o=1-s.life/s.max;s.r=O(s.sr,s.er,o),s.g=O(s.sg,s.eg,o),s.b=O(s.sb,s.eb,o),s.a=1-o}}render(t){for(let e=0;e<this.pool.length;e++){const s=this.pool[e];if(!s.alive)continue;const o=s.p.x|0,n=s.p.y|0;t.globalAlpha=s.a,t.fillStyle=`rgb(${s.r|0},${s.g|0},${s.b|0})`,t.fillRect(o,n,s.size,s.size)}t.globalAlpha=1}cleanup(){}}const L=.999;class J{position={x:0,y:0};velocity={x:1,y:1};rotation=0;angularVelocity=.5;sprite;size=128;score=0;isOld=!1;timerId;isOver=!1;constructor(t,e,s){this.sprite=f.getInstance().get(t),this.position=e,this.velocity=s,this.score=et(t),this.timerId=setTimeout(()=>{this.isOld=!0,clearTimeout(this.timerId)},1e4)}free(){this.score=0,this.isOver=!0}update(t){this.rotation+=this.angularVelocity*t,this.position.x+=this.velocity.x*t,this.position.y+=this.velocity.y*t,this.velocity.x*=L,this.velocity.y*=L,this.isOver&&(this.size-=1,this.size<=0&&lt(this))}render(t){const e=this.size/2;t.save(),t.translate(Math.floor(this.position.x+e),Math.floor(this.position.y+e)),t.rotate(this.rotation),t.drawImage(this.sprite,0,0,32,32,Math.floor(-e),Math.floor(-e),this.size,this.size),t.restore()}}const W=.99999999,F=2,dt=.997;class ut{position={x:u/2-64,y:p/2-64};velocity={x:1,y:1};thrust=180;sprite=f.getInstance().get("cat");rotation=0;size=128;angularVelocity=.5;children=[];stateMachine;timerCollision;timerLife;life=25;lifeText;constructor(t){this.stateMachine=t;const e=new ft({endColor:[255,0,68],startColor:[254,231,97],life:.35,size:16,spread:Math.PI/3,baseSpeed:220,speedJitter:180,rate:160,trickleRate:0});this.lifeText=new c(this.life.toString(),{...r,y:80}),this.children.push(e,this.lifeText),this.timerCollision=setInterval(()=>{this.handleCollisions()},50),this.timerLife=setInterval(()=>{this.life-=1,this.life<=0&&this.stateMachine.changeState(d.END_SCREEN)},1e3)}updateMovement(t){(l(h.A)||l(h.LEFT))&&(this.angularVelocity-=F*t),(l(h.D)||l(h.RIGHT))&&(this.angularVelocity+=F*t),this.rotation+=this.angularVelocity*t,this.angularVelocity*=dt,(l(h.W)||l(h.UP))&&(this.velocity.x+=Math.cos(this.rotation)*this.thrust*t,this.velocity.y+=Math.sin(this.rotation)*this.thrust*t,a.play("power")),(l(h.S)||l(h.DOWN))&&(this.velocity.x-=Math.cos(this.rotation)*this.thrust*t,this.velocity.y-=Math.sin(this.rotation)*this.thrust*t),this.position.x+=this.velocity.x*t,this.position.y+=this.velocity.y*t,this.velocity.x*=W,this.velocity.y*=W}handleBounce(){this.position.x<0&&(this.position.x=0,this.velocity.x*=-.7,a.play("bounce")),this.position.x+this.size>u&&(this.position.x=u-this.size,this.velocity.x*=-.7,a.play("bounce")),this.position.y<0&&(this.position.y=0,this.velocity.y*=-.7,a.play("bounce")),this.position.y+this.size>p&&(this.position.y=p-this.size,this.velocity.y*=-.7,a.play("bounce"))}handleParticles(){const t=this.size/2,e=Math.floor(this.position.x+t),s=Math.floor(this.position.y+t),o=this.children[0];o.anchorTo({x:e,y:s},this.rotation,8),o.setThrottle(l(h.W)||l(h.UP)?1:0)}handleCollisions(){for(let t of y)j(this,t)&&(t instanceof J?(ht(t.score),this.life+=t.score,t.score&&a.play("food"),t.free()):(this.stateMachine.changeState(d.END_SCREEN),a.play("death")))}update(t){this.updateMovement(t),this.handleBounce(),this.handleParticles(),this.lifeText.text=this.life.toString();for(let e of this.children)e.update(t)}render(t){for(let s of this.children)s.render(t);const e=this.size/2;t.save(),t.translate(Math.floor(this.position.x+e),Math.floor(this.position.y+e)),t.rotate(this.rotation),t.drawImage(this.sprite,0,0,32,32,Math.floor(-e),Math.floor(-e),this.size,this.size),t.restore()}cleanup(){clearInterval(this.timerCollision),clearInterval(this.timerLife)}}class pt{timerId=null;waitTime;callback;running=!1;constructor(t,e){this.waitTime=t,this.callback=e}getDelay(){return typeof this.waitTime=="number"?this.waitTime:B(this.waitTime[0],this.waitTime[1])}tick=()=>{this.callback(),this.running&&(this.timerId=setTimeout(this.tick,this.getDelay()))};start(){this.running||(this.running=!0,this.timerId=setTimeout(this.tick,this.getDelay()))}stop(){this.timerId!==null&&(clearTimeout(this.timerId),this.timerId=null),this.running=!1}}class T{position;direction;timer;constructor(t){this.position=X(t),this.direction=t,this.timer=new pt([1e3,7e3],this.spawn.bind(this)),this.timer.start()}getRandomFood(){const t=[{name:"fish",weight:6},{name:"cheese",weight:5},{name:"watermelon",weight:1},{name:"coffee",weight:2},{name:"donut",weight:3},{name:"susha",weight:4}],e=t.reduce((o,n)=>o+n.weight,0);let s=Math.random()*e;for(const o of t){if(s<o.weight)return o.name;s-=o.weight}return"watermelon"}spawn(){let t;Math.random()>.75?t=new H({...this.position},P(this.direction,150)):t=new J(this.getRandomFood(),{...this.position},P(this.direction,100)),y.push(t)}cleanup(){this.timer.stop()}}class yt extends R{spawns=[];scoreText;constructor(t){super(t),ct(),this.spawns.push(new T("top"),new T("bottom"),new T("left"),new T("right")),this.scoreText=new c(`score-${v.toString()}`,{...r,y:36}),this.children.push(new N,new ut(t),this.scoreText),a.music(),setInterval(()=>at(),1e4)}update(t){for(let e of this.children)e.update(t);for(let e of y)e.update(t);this.scoreText.text=`score-${v.toString()}`}render(t){for(let e of this.children)e.render(t);for(let e of y)e.render(t)}cleanup(){for(let t of this.children)t.cleanup();this.spawns.forEach(t=>t.cleanup())}}class mt extends R{starField;constructor(t){super(t),this.starField=new N;const e=new c(`score ${v}`,{x:r.x,y:r.y-200}),s=new c("the cat is gone but the menu lives on",{x:r.x,y:r.y-100}),o=new c("press space to restart",{x:r.x,y:r.y+200});this.children.push(this.starField,s,e,o)}update(){q(h.SPACE)&&(this.stateMachine.changeState(d.WORLD),a.play("start")),this.starField.generate()}render(t){for(let e of this.children)e.render(t)}cleanup(){a.stopMusic()}}const $={[d.START_MENU]:rt,[d.WORLD]:yt,[d.LOADING]:K,[d.END_SCREEN]:mt};class w{static instance=null;states;currentState;constructor(t){this.states=t,this.currentState=new K(this)}static getInstance(){if(!w.instance){if(!$)throw new Error("StateMachine requires states for the first initialization.");w.instance=new w($)}return w.instance}changeState(t){const e=this.states[t];if(!e)throw new Error(`State "${t}" does not exist`);this.currentState.cleanup(),this.currentState=new e(this)}update(t){this.currentState.update(t)}render(t){this.currentState.render(t)}}const gt=document.getElementById("canvas"),x=gt.getContext("2d",{alpha:!1}),C=window.devicePixelRatio;x.scale(C,C);x.canvas.width=u*C;x.canvas.height=p*C;x.imageSmoothingEnabled=!1;const A=w.getInstance(),wt=f.getInstance();let k=0,U=performance.now();const _=i=>{k=(i-U)/1e3,Z(x),A.update(k),A.render(x),U=i,requestAnimationFrame(_)};wt.loadAll({alfabet:"alefbet.png",cat:"cat.png",cheese:"cheese.png",donut:"donut.png",fish:"fish.png",susha:"susha.png",asteroid:"asteroid.png",coffee:"coffee.png",watermelon:"watermelon.png"}).then(()=>{A.changeState(d.START_MENU),requestAnimationFrame(_)});
