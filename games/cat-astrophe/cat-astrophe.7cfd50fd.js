let e;function t(e){let t=document.querySelector(e);if(!t)throw Error(`Element not found: ${e}`);return t}const o=t("#music"),i=t("#sound"),n=t("#score"),r=t("#text"),a=t("#the-button"),s=t("#arrows"),c=t("#subtitles");let l=setTimeout(()=>{},0);function d(e,t=!1){clearTimeout(l),c.className=t?"catastrophe":"",c.innerText=e}function p(e=2e3){clearTimeout(l),l=setTimeout(()=>c.className+=" hide",e)}function u(e){return e[Math.floor(Math.random()*e.length)]}window.addEventListener("keydown",e=>{if(!e.repeat)switch(s.className="hide",e.key){case"ArrowUp":case"w":eu("up");break;case"ArrowDown":case"s":eu("down");break;case"ArrowLeft":case"a":eu("left");break;case"ArrowRight":case"d":eu("right");break;case"Enter":case" ":eh()}}),o.onclick=()=>o.innerText=ed("music")?"\uD83D\uDD0A":"\uD83D\uDD07",i.onclick=()=>i.innerText=ed("sound")?"\uD83D\uDCAC":"\uD83D\uDEAB",t("#up").onclick=()=>eu("up"),t("#down").onclick=()=>eu("down"),t("#left").onclick=()=>eu("left"),t("#right").onclick=()=>eu("right"),a.onclick=eh;const h="#000000",y="#654321",g="#FF4500",f="#FFFDD0",x="#F5F5DC";var m=[{name:"Introductions",size:{x:5,y:5},start:{x:1,y:3},end:{x:5,y:3},boxes:[{x:3,y:2}],cats:[{color:h,speed:1,start:{x:3,y:6,direction:"up"},change:[]}]},{name:"Two cats",size:{x:5,y:5},start:{x:1,y:3},end:{x:5,y:3},boxes:[{x:2,y:2},{x:4,y:4}],cats:[{color:h,speed:1,start:{x:2,y:6,direction:"up"},change:[]},{color:h,speed:1,start:{x:4,y:0,direction:"down"},change:[]}]},{name:"First cat turn",size:{x:7,y:5},start:{x:1,y:3},end:{x:7,y:3},boxes:[{x:4,y:2},{x:4,y:4}],cats:[{color:h,speed:1,start:{x:2,y:6,direction:"up"},change:[{step:4,direction:"right"}]},{color:h,speed:1,start:{x:6,y:0,direction:"down"},change:[{step:4,direction:"left"}]}]},{name:"Cat spiral",size:{x:8,y:8},start:{x:1,y:4},end:{x:5,y:4},boxes:[{x:4,y:4}],cats:[{color:h,speed:1,start:{x:4,y:4,direction:"up"},change:[{step:1,direction:"right"},{step:3,direction:"down"},{step:6,direction:"left"},{step:10,direction:"up"},{step:15,direction:"right"},{step:21,direction:"down"},{step:28,direction:"left"}]}]},{name:"Brown cat",size:{x:5,y:5},start:{x:1,y:3},end:{x:5,y:3},boxes:[],cats:[{color:y,speed:1,start:{x:3,y:6,direction:"up"},change:[]}]},{name:"Rainbow",size:{x:11,y:6},start:{x:1,y:3},end:{x:11,y:4},boxes:[{x:1,y:1},{x:3,y:2},{x:5,y:3},{x:7,y:4},{x:9,y:5},{x:11,y:6}],cats:[{color:x,speed:1,start:{x:1,y:7,direction:"up"},change:[]},{color:f,speed:1,start:{x:3,y:7,direction:"up"},change:[]},{color:g,speed:1,start:{x:5,y:7,direction:"up"},change:[]},{color:y,speed:1,start:{x:7,y:7,direction:"up"},change:[]},{color:h,speed:1,start:{x:9,y:7,direction:"up"},change:[]},{color:x,speed:1,start:{x:3,y:2,direction:"up"},change:[{step:1,direction:"right"}]},{color:f,speed:1,start:{x:5,y:3,direction:"up"},change:[{step:1,direction:"right"}]},{color:h,speed:1,start:{x:7,y:4,direction:"up"},change:[{step:1,direction:"right"}]},{color:g,speed:1,start:{x:9,y:5,direction:"up"},change:[{step:1,direction:"right"}]},{color:y,speed:1,start:{x:11,y:6,direction:"up"},change:[{step:1,direction:"right"}]}]},{name:"Cats of all colors",size:{x:8,y:8},start:{x:1,y:4},end:{x:8,y:4},boxes:[],cats:[{color:h,speed:1,start:{x:2,y:0,direction:"down"},change:[{step:7,direction:"right"},{step:9,direction:"up"}]},{color:h,speed:1,start:{x:9,y:5,direction:"left"},change:[{step:3,direction:"down"}]},{color:h,speed:1,start:{x:9,y:5,direction:"left"},change:[{step:3,direction:"down"}]},{color:y,speed:1,start:{x:0,y:3,direction:"right"},change:[{step:4,direction:"down"}]},{color:y,speed:1,start:{x:5,y:9,direction:"up"},change:[{step:6,direction:"left"}]},{color:g,speed:1,start:{x:6,y:0,direction:"down"},change:[{step:6,direction:"left"}]},{color:f,speed:1,start:{x:0,y:5,direction:"right"},change:[{step:6,direction:"up"}]},{color:x,speed:1,start:{x:9,y:7,direction:"left"},change:[{step:6,direction:"up"},{step:10,direction:"right"}]}]},{name:"Box array big",size:{x:11,y:11},start:{x:1,y:6},end:{x:11,y:6},boxes:[{x:1,y:1},{x:1,y:3},{x:1,y:5},{x:1,y:7},{x:3,y:1},{x:3,y:3},{x:3,y:5},{x:3,y:7},{x:3,y:9},{x:5,y:1},{x:5,y:3},{x:5,y:5},{x:5,y:7},{x:5,y:9},{x:5,y:11},{x:7,y:1},{x:7,y:3},{x:7,y:5},{x:7,y:7},{x:7,y:9},{x:7,y:11},{x:9,y:3},{x:9,y:5},{x:9,y:7},{x:9,y:9},{x:9,y:11},{x:11,y:5},{x:11,y:7},{x:11,y:9},{x:11,y:11}],cats:[{color:h,speed:1,start:{x:5,y:7,direction:"left"},change:[]},{color:h,speed:1,start:{x:3,y:7,direction:"left"},change:[]},{color:h,speed:1,start:{x:3,y:9,direction:"right"},change:[]},{color:h,speed:1,start:{x:5,y:9,direction:"right"},change:[]},{color:h,speed:1,start:{x:7,y:9,direction:"up"},change:[]},{color:h,speed:1,start:{x:7,y:7,direction:"up"},change:[]},{color:h,speed:1,start:{x:7,y:5,direction:"left"},change:[]},{color:h,speed:1,start:{x:5,y:5,direction:"left"},change:[]},{color:h,speed:1,start:{x:3,y:5,direction:"left"},change:[]},{color:h,speed:1,start:{x:7,y:3,direction:"right"},change:[]},{color:h,speed:1,start:{x:9,y:3,direction:"down"},change:[]},{color:h,speed:1,start:{x:9,y:5,direction:"down"},change:[]},{color:h,speed:1,start:{x:9,y:7,direction:"down"},change:[]},{color:h,speed:1,start:{x:9,y:9,direction:"down"},change:[]},{color:h,speed:1,start:{x:1,y:1,direction:"right"},change:[]},{color:h,speed:1,start:{x:3,y:1,direction:"right"},change:[]},{color:h,speed:1,start:{x:5,y:1,direction:"down"},change:[]},{color:h,speed:1,start:{x:5,y:3,direction:"left"},change:[]},{color:h,speed:1,start:{x:3,y:3,direction:"left"},change:[]},{color:h,speed:1,start:{x:1,y:3,direction:"up"},change:[]}]},{name:"Box array small",size:{x:9,y:9},start:{x:1,y:5},end:{x:9,y:5},boxes:[{x:2,y:2},{x:2,y:4},{x:2,y:6},{x:2,y:8},{x:4,y:2},{x:4,y:4},{x:4,y:6},{x:4,y:8},{x:6,y:2},{x:6,y:4},{x:6,y:6},{x:6,y:8},{x:8,y:2},{x:8,y:4},{x:8,y:6},{x:8,y:8}],cats:[{color:h,speed:1,start:{x:2,y:4,direction:"left"},change:[]},{color:h,speed:1,start:{x:2,y:2,direction:"right"},change:[]},{color:h,speed:1,start:{x:6,y:2,direction:"left"},change:[]},{color:h,speed:1,start:{x:4,y:2,direction:"down"},change:[]},{color:h,speed:1,start:{x:4,y:4,direction:"down"},change:[]},{color:h,speed:1,start:{x:4,y:6,direction:"left"},change:[]},{color:h,speed:1,start:{x:2,y:6,direction:"left"},change:[]},{color:h,speed:1,start:{x:8,y:6,direction:"left"},change:[]},{color:h,speed:1,start:{x:6,y:6,direction:"up"},change:[]},{color:h,speed:1,start:{x:6,y:4,direction:"right"},change:[]},{color:h,speed:1,start:{x:8,y:4,direction:"up"},change:[]},{color:h,speed:1,start:{x:8,y:2,direction:"right"},change:[]},{color:h,speed:1,start:{x:4,y:8,direction:"right"},change:[]},{color:y,speed:1,start:{x:2,y:8,direction:"right"},change:[]},{color:g,speed:1,start:{x:6,y:8,direction:"right"},change:[]},{color:f,speed:1,start:{x:2,y:6,direction:"up"},change:[]},{color:y,speed:1,start:{x:2,y:4,direction:"up"},change:[]},{color:x,speed:1,start:{x:8,y:4,direction:"down"},change:[]},{color:y,speed:1,start:{x:6,y:6,direction:"down"},change:[]}]},{name:"Confused",size:{x:11,y:9},start:{x:1,y:5},end:{x:11,y:5},boxes:[{x:7,y:5}],cats:[{color:h,speed:1,start:{x:12,y:1,direction:"left"},change:[{step:11,direction:"down"},{step:14,direction:"right"},{step:16,direction:"up"},{step:19,direction:"right"},{step:26,direction:"down"},{step:30,direction:"up"},{step:34,direction:"left"},{step:40,direction:"down"},{step:46,direction:"up"},{step:50,direction:"left"}]},{color:h,speed:1,start:{x:0,y:8,direction:"right"},change:[{step:2,direction:"up"},{step:4,direction:"left"},{step:5,direction:"down"},{step:8,direction:"right"},{step:15,direction:"up"},{step:18,direction:"left"},{step:19,direction:"down"},{step:21,direction:"right"},{step:25,direction:"up"},{step:26,direction:"left"},{step:31,direction:"up"},{step:34,direction:"right"},{step:36,direction:"down"}]},{color:y,speed:1,start:{x:7,y:5,direction:"up"},change:[{step:1,direction:"left"},{step:2,direction:"down"},{step:4,direction:"right"},{step:6,direction:"up"},{step:8,direction:"left"},{step:9,direction:"down"}]},{color:f,speed:1,start:{x:7,y:5,direction:"left"},change:[{step:1,direction:"down"},{step:2,direction:"right"},{step:4,direction:"up"},{step:6,direction:"left"},{step:8,direction:"down"},{step:9,direction:"right"}]},{color:g,speed:1,start:{x:7,y:5,direction:"down"},change:[{step:1,direction:"right"},{step:2,direction:"up"},{step:4,direction:"left"},{step:6,direction:"down"},{step:8,direction:"right"},{step:9,direction:"up"}]},{color:x,speed:1,start:{x:7,y:5,direction:"right"},change:[{step:1,direction:"up"},{step:2,direction:"left"},{step:4,direction:"down"},{step:6,direction:"right"},{step:8,direction:"up"},{step:9,direction:"left"}]}]},{name:"Maze",size:{x:10,y:12},start:{x:1,y:6},end:{x:10,y:3},boxes:[{x:2,y:2},{x:5,y:2},{x:9,y:2},{x:10,y:4},{x:1,y:9},{x:2,y:11},{x:5,y:10},{x:9,y:11}],cats:[{color:h,speed:1,start:{x:2,y:2,direction:"right"},change:[]},{color:h,speed:1,start:{x:5,y:2,direction:"left"},change:[{step:1,direction:"down"},{step:2,direction:"right"},{step:3,direction:"down"},{step:8,direction:"right"},{step:10,direction:"down"},{step:14,direction:"left"},{step:15,direction:"down"}]},{color:h,speed:1,start:{x:2,y:11,direction:"right"},change:[{step:1,direction:"up"},{step:2,direction:"right"}]},{color:h,speed:1,start:{x:5,y:10,direction:"left"},change:[{step:2,direction:"up"},{step:7,direction:"left"},{step:8,direction:"up"},{step:9,direction:"left"}]},{color:h,speed:1,start:{x:9,y:11,direction:"up"},change:[{step:5,direction:"left"},{step:7,direction:"up"}]},{color:h,speed:1,start:{x:10,y:4,direction:"left"},change:[{step:1,direction:"up"}]},{color:y,speed:1,start:{x:5,y:2,direction:"down"},change:[]}]},{name:"Direct",size:{x:7,y:7},start:{x:1,y:4},end:{x:7,y:4},boxes:[],cats:[{color:h,speed:1,start:{x:0,y:5,direction:"right"},change:[{step:3,direction:"down"},{step:5,direction:"left"},{step:7,direction:"up"},{step:8,direction:"right"},{step:13,direction:"up"},{step:14,direction:"left"},{step:16,direction:"down"},{step:18,direction:"left"},{step:19,direction:"up"},{step:21,direction:"right"},{step:23,direction:"down"},{step:24,direction:"right"}]},{color:h,speed:1,start:{x:8,y:3,direction:"left"},change:[{step:3,direction:"up"},{step:5,direction:"left"},{step:7,direction:"down"},{step:8,direction:"right"},{step:9,direction:"up"},{step:10,direction:"left"},{step:13,direction:"down"},{step:15,direction:"right"},{step:17,direction:"up"},{step:18,direction:"right"},{step:19,direction:"down"},{step:20,direction:"up"},{step:22,direction:"down"},{step:23,direction:"right"}]},{color:y,speed:1,start:{x:2,y:0,direction:"down"},change:[{step:5,direction:"right"},{step:8,direction:"up"},{step:10,direction:"left"},{step:12,direction:"down"},{step:15,direction:"right"},{step:18,direction:"up"},{step:21,direction:"left"},{step:13,direction:"down"}]},{color:g,speed:1,start:{x:6,y:8,direction:"up"},change:[{step:5,direction:"left"},{step:8,direction:"down"},{step:10,direction:"right"},{step:12,direction:"up"},{step:15,direction:"left"},{step:18,direction:"down"},{step:22,direction:"right"},{step:23,direction:"up"},{step:24,direction:"left"}]},{color:f,speed:1,start:{x:6,y:0,direction:"down"},change:[{step:2,direction:"left"},{step:3,direction:"down"},{step:5,direction:"left"},{step:7,direction:"down"},{step:10,direction:"right"},{step:11,direction:"up"},{step:14,direction:"right"},{step:15,direction:"down"},{step:16,direction:"right"},{step:17,direction:"up"},{step:19,direction:"left"},{step:22,direction:"right"}]},{color:x,speed:1,start:{x:2,y:8,direction:"up"},change:[{step:3,direction:"right"},{step:5,direction:"up"},{step:7,direction:"right"},{step:9,direction:"down"},{step:11,direction:"left"},{step:14,direction:"up"},{step:15,direction:"right"},{step:17,direction:"up"},{step:20,direction:"down"},{step:24,direction:"right"}]}]},{name:"13",size:{x:7,y:7},start:{x:1,y:4},end:{x:7,y:4},boxes:[{x:2,y:1},{x:2,y:2},{x:2,y:3},{x:2,y:5},{x:2,y:6},{x:2,y:7},{x:4,y:1},{x:5,y:1},{x:6,y:2},{x:6,y:3},{x:4,y:4},{x:4,y:7},{x:5,y:7},{x:6,y:6},{x:6,y:5}],cats:[]}];const w=document.getElementById("canvas"),b=w.getContext("2d");function T(e){let t=window.innerWidth,o=window.innerHeight,i=Math.min(t/(e.x+2),o/(e.y+2)),n=e.x*i,r=e.y*i,a=(t-n)/2,s=(o-r)/2;return{squareSize:i,x:e=>a+(e-1)*i,y:e=>s+(e-1)*i}}function D(e=1,t=0){let o=Math.floor(500/e);return(Date.now()-t*o)%o/o}function k(e,t,o=1){return e+(t-e)*D(o)}function v(e){return .5*(1-Math.cos(Math.PI*e*2))}function S(e){return .5*(1-Math.sin(Math.PI*e*2))}function A(e,t,o=Date.now()){return o<e?0:o>e+t?1:v((o-e)/t/2)}let P=[];function C(e,t,o){let i=t.x(e.x+.7),n=t.y(e.y+.7),r=v(D(.5))-.5;b.save(),o&&(b.globalAlpha=1-A(o,300)),b.font=`${.4*t.squareSize}px sans-serif`,b.textBaseline="middle",b.textAlign="center",b.fillText("\uD83D\uDEA7",i,n+r*t.squareSize*.02),b.restore()}const E=["\uD83C\uDF6C","\uD83C\uDF6D","\uD83C\uDF6E","\uD83C\uDF6B","\uD83C\uDF6F","\uD83C\uDF82","\uD83C\uDF70","\uD83C\uDF69","\uD83C\uDF6A","\uD83E\uDDC1","\uD83E\uDD67"];let M=u(E);const F=[];let z=1;function I(e,t,o){let i={x:k(e.x,t.x),y:k(e.y,t.y)};e.x<t.x?z=1:e.x>t.x?z=3:e.y<t.y?z=2:e.y>t.y&&(z=0);let n=e.x!==t.x||e.y!==t.y,r=S(D(1))-.5,a=S(D(.2))-.5,s="#000000",c=o.squareSize/2;b.save(),b.translate(o.x(i.x+.5),o.y(i.y+.5)),b.rotate(z*Math.PI/2),n&&(Y(o,-.1*c,r),Y(o,-(.6*c),-r));let l=.3*c,d=.1*c,p=-Math.PI/3;b.save(),b.translate(.22*c,-.37*c),b.rotate(p),b.strokeStyle=s,b.beginPath(),b.roundRect(0,-d/2,l,d,.1*c),b.fillStyle="#A0522D",b.fill(),b.stroke(),b.beginPath(),b.arc(l,0,d/2,-Math.PI/2,Math.PI/2,!1),b.fillStyle="#FF0000",b.fill(),b.stroke(),b.restore();let u=.6*c;b.strokeStyle=s,b.fillStyle="#5C4033",b.lineWidth=.02*c,b.beginPath(),b.arc(0,0,u,0,2*Math.PI,!1),b.fill(),b.stroke(),b.beginPath(),b.arc(0,0,.55*u,0,2*Math.PI,!1),b.stroke(),b.beginPath(),b.ellipse(0,0,.2*u,.37*u,0,0,2*Math.PI,!1),b.stroke(),b.beginPath(),b.moveTo(.4*u,.1*u),b.quadraticCurveTo(.25*u,-.1*u,.25*u,-.35*u),b.stroke(),b.beginPath(),b.moveTo(-.4*u,.1*u),b.quadraticCurveTo(-.25*u,-.1*u,-.25*u,-.35*u),b.stroke(),b.lineWidth=.1*c,b.lineCap="round";let h=b.createLinearGradient(.4*c,-.6*c,.4*c,-.3*c);h.addColorStop(0,"rgba(180, 180, 180, 0.9)"),h.addColorStop(1,"rgba(255, 255, 255, 0.1)"),b.strokeStyle=h,b.beginPath(),b.moveTo(.4*c,-.56*c),b.bezierCurveTo(.4*c+a*c*.18,-.5*c,.4*c-a*c*.18,-.4*c,.4*c,-.3*c),b.stroke(),b.restore()}function Y(e,t=0,o=0){let i=e.squareSize/2;b.save(),b.translate(t,o*i*.9+-.4*i),b.lineWidth=.02*i,b.strokeStyle="#000000",b.fillStyle="#D2B48C",b.beginPath(),b.roundRect(.2*i,0,.3*i,.7*i,.2*i),b.fill(),b.stroke(),b.fillStyle="#EEE",b.beginPath(),b.roundRect(.25*i,.05*i,.2*i,.6*i,.2*i),b.fill(),b.beginPath(),b.moveTo(.3*i,.18*i),b.lineTo(.4*i,.18*i),b.stroke(),b.beginPath(),b.moveTo(.3*i,.22*i),b.lineTo(.4*i,.22*i),b.stroke(),b.fillStyle="#999",b.beginPath(),b.arc(.35*i,.72*i,.07*i,0,2*Math.PI,!1),b.fill(),b.stroke(),b.restore()}const q=["❗","⚠️","❌","\uD83D\uDEAB","\uD83D\uDED1"];let B=u(E);function N(e,t,o,i,n,r,a){b.save(),b.translate(-60*t,0),R(e,t,o,i,n,r,a),b.translate(120*t,0),R(e,t,o,i,n,r,a),b.restore()}function R(e,t,o,i,n,r,a){b.save();let s=A(o,300,a),c=A(o,1e3,a),l=A(o+1e3,1e3,a);b.globalAlpha=n*s*(1-A(i,1e3,a)),b.translate(r.x(e.x)-50*t,r.y(e.y)-50*t),b.scale(t,t),b.fillStyle="#FFF",b.strokeStyle="#000",b.lineWidth=5,b.lineCap="square",b.beginPath(),b.moveTo(0,50),b.quadraticCurveTo(50,50+50*c,100,50),b.quadraticCurveTo(50,50-50*c,0,50),b.closePath(),b.fill(),b.stroke(),b.fillStyle="#000",b.beginPath(),b.moveTo(50,30),b.quadraticCurveTo(50+10*l,50,50,70),b.quadraticCurveTo(50-10*l,50,50,30),b.closePath(),b.fill(),b.restore()}function L(e,t,o,i,n){let r=(Date.now()-t)/500,a=r<1?"jumpIn":"walk",s=e.start,c=e.start.direction;for(let t=0;t<=r-1;t++){if(W(s=G(s,c),o)||(n&&e.color===h&&(n[s.y-1][s.x-1]=!0),j(s,i))){a="hide";break}let r=e.change.find(e=>e.step===t+1);r&&(c=r.direction)}if("hide"!==a){let e=G(s,c);W(e,o)&&(a="jumpOut"),j(e,i)&&(a="jumpOut");let t=r-Math.floor(r);s={x:s.x+(e.x-s.x)*t,y:s.y+(e.y-s.y)*t}}return{isDone:"hide"===a,position:s,direction:c,state:a}}function G(e,t){return{x:e.x+("right"===t?1:"left"===t?-1:0),y:e.y+("down"===t?1:"up"===t?-1:0)}}function W(e,t){return e.x<1||e.x>t.x||e.y<1||e.y>t.y}function j(e,t){return void 0!==t.find(t=>t.x===e.x&&t.y===e.y)}const O=`
|------------0b--|----2b----------|----0b----------|
|----0b--1b------|3b------0b--0-3-|1b----------3-1-|
|0b----0---0---0-|--0---0---0-----|--0---0-2b------|
|--0-------------|----------------|----------0-----|
|----------------|----------------|----------------|
|----------------|----------------|----------------|

|--------------|----------0b--|----2b----------|
|0b--0b3-------|--0b--1b------|3b------0b--0-3-|
|--0-----0b----|0---0---0---0b|--0---0---0-----|
|----------4b2b|--------------|----------------|
|--------------|--------------|----------------|
|--------------|--------------|----------------|

|----0b----------|----------------|
|1b----------3-1-|0b----------3---|
|--0---0b2b------|----2b0b2b------|
|----------0b----|--0-------0---0-|
|----------------|----------------|
|----------------|----------------|`,V="C C# D D# E F F# G G# A A# B".split(" "),H="E4 B3 G3 D3 A2 E2".split(" "),$=function(e){let t=e.trim().split("\n\n"),o=["","","","","",""];t.forEach(e=>e.split("\n").forEach((e,t)=>o[t]+=e.replaceAll("|","")));let i=[];for(let e=0;e<o[0].length;e++){let t=[];for(let i=0;i<H.length;i++){var n,r;let a=o[i][e];if(parseInt(n=a).toString()===n){let n=parseInt(a),[s,c]=H[i],l=V.indexOf(s)+n,d=V[l%V.length]+(l<V.length?c:parseInt(c)+1),p=o[i][e+1],u=(r=p)&&/[a-zA-Z]/.test(r)?p:"";t.push({note:d,flag:u,freq:function(e){let t={C:-9,"C#":-8,Db:-8,D:-7,"D#":-6,Eb:-6,E:-5,F:-4,"F#":-3,Gb:-3,G:-2,"G#":-1,Ab:-1,A:0,"A#":1,Bb:1,B:2,H:2},o=e.match(/^([A-G|H])([#b]?)([0-8])$/);if(!o)throw Error("Invalid note format.");let i=o[1],n=o[2],r=parseInt(o[3],10),a=i+n;if(!(a in t))throw Error(`Unknown note: ${a}`);return 440*Math.pow(2,(12*(r-4)+t[a])/12)}(d),volume:1})}}i.push(t)}return i}(O);let U=!1;function J(){e||(e=new AudioContext),U||(U=!0,function e(t=0){let{controls:{music:o}}=function(){return el}();if(!o)return U=!1;let i=$[t];if(!i)return e(0);setTimeout(()=>e(t+1),200),i.forEach(e=>{"b"===e.flag?Q(e.freq,.6000000000000001,.4*e.volume):Q(e.freq,.6000000000000001,.2*e.volume)})}(0))}function Q(t,o,i,n="sine"){let r=e.currentTime,a=e.createGain();a.connect(e.destination),a.gain.setValueAtTime(0,r),a.gain.linearRampToValueAtTime(.2*i*1,r+.02),a.gain.linearRampToValueAtTime(.2*i*.3,r+o/2),a.gain.linearRampToValueAtTime(0,r+o);let s=[1,.5,.3,.15,.1,.05];[1,2,3,4,5,6].forEach((i,c)=>{let l=e.createOscillator(),d=e.createGain();l.type=n,l.frequency.value=t*i,d.gain.value=s[c],l.connect(d),d.connect(a),l.start(r),l.stop(r+o)});let c=e.createBufferSource(),l=.05*e.sampleRate,d=e.createBuffer(1,l,e.sampleRate),p=d.getChannelData(0);for(let e=0;e<l;e++)p[e]=2*Math.random()-1;c.buffer=d;let u=e.createBiquadFilter();u.type="bandpass",u.frequency.value=1500,u.Q.value=1;let h=e.createGain();h.gain.setValueAtTime(.3,r),h.gain.exponentialRampToValueAtTime(.001,r+.05),c.connect(u),u.connect(h),h.connect(a),c.start(r),c.stop(r+.05)}function Z(e,t,o,i,n,r,a){let s=e.createGain();s.gain.setValueAtTime(a,o),s.connect(t);let c=e.createOscillator();c.type="sine",c.connect(s),c.frequency.setValueAtTime(n.start*r,o),c.frequency.linearRampToValueAtTime(n.peak*r,o+.1),c.frequency.exponentialRampToValueAtTime(n.end*r,o+i),c.start(o),c.stop(o+i)}const K=["\uD83D\uDC08","\uD83D\uDC31","\uD83D\uDE3A","\uD83D\uDE38","\uD83D\uDE39","\uD83D\uDE3B","\uD83D\uDE3C","\uD83D\uDE3D","\uD83D\uDE40","\uD83D\uDE3F","\uD83D\uDE3E"];function X(){let{controls:{sound:t}}=el;if(t){!function(t,o,i=.5){e||(e=new AudioContext);let n=e.currentTime,r={start:.9*t,peak:1.02*t,end:.8*t},a=e.createGain();a.connect(e.destination),a.gain.setValueAtTime(0,n),a.gain.linearRampToValueAtTime(.7,n+.05),a.gain.linearRampToValueAtTime(0,n+.4),Z(e,a,n,.4,r,1,.3*i*1),Z(e,a,n,o,r,2,.3*i*.4),Z(e,a,n,o,r,3,.3*i*.2),Z(e,a,n,o,r,4,.3*i*.1)}(500*Math.random()+700,.4);let t=u(K);c.innerText=t+" Meow "+t,c.className="",setTimeout(()=>c.className="hide",500)}}const _={up:["Up","Up we go.","Going up.","To the top.","Upwards.","Climbing.","Higher.","Let's ascend.","Up again?","This way up.","Why up?","Gravity calls.","To the sky."],down:["Down","Going down.","Downward.","Deeper.","Let's drop.","Descending.","To the depths.","Down we go.","What's below?","Down there?","Easy now."],left:["Left","To the left.","Going left.","Left it is.","Leftward.","A left.","On my left.","Left again.","Why left?","Nothing's right.","Alright, left."],right:["Right","To the right.","Going right.","Right away.","Rightward.","That's right.","On my right.","Right again?","Seems right.","Okay, right."]},ee=["Alright, boss, let's get that candy!","Time to hunt for some sugar. What could go wrong?","Let's do this! My sweet tooth is tingling.","A sweet reward for a sweet hero. Let's go!","No superstitions can stop me. Onward!","Okay, deep breaths. Just... avoid all shadows.","I have a bad feeling about this. Did you see that cat?","Hopefully, my luck holds out. That candy better be worth it.","I just saw a black cat. I'm not going that way.","Let's just get this over with. Carefully.","A quest for candy, avoiding feline-induced doom. My life is complete.","Great. Another day, another chance to be tripped by a cat.","Is that a black cat or just a void with legs? Nope, not finding out.","Let's see... Ladders, black cats, broken mirrors. What else you got?","I swear, if I step on a crack, I'm blaming you."],et=["You stepped on a Lego brick with your bare foot. The pain was so intense, you briefly saw the future.","Your brain decided now was the perfect time to replay that moment in fifth grade when you accidentally called the teacher 'Mom.' The cringe was so physical you had to stop and curl into a ball.","You bit into your emergency chocolate chip cookie, only to discover it was oatmeal raisin. The betrayal.","Your emergency donut fell on the floor. You quickly invoked the 'five-second rule' to pick it up, only to immediately slip on it.","A tiny, personal rain cloud formed directly over your head and started to pour. You suddenly felt like the main character in a very sad cartoon.","For a split second, the paving stone you stepped on felt like it was made of Jell-O. The ensuing wave of uncertainty made you question the fabric of reality.","A sudden gust of wind blew directly into your eyes, forcing a sneeze so powerful it sent you one involuntary step backward.","You tripped, but instead of falling, you miraculously executed an elegant, albeit completely unintentional, pirouette. No one saw it, which is somehow even more tragic.","You just received a call from a man with a very serious voice, informing you that your subscription to 'Cactus Monthly' has expired. You've never owned a cactus in your life.","An old shopping list fell out of your pocket. Before you could grab it, a gust of wind plastered it onto the windshield of a passing bus. The world now knows you're out of toilet paper.","You just realized you've been humming the jingle from a cat food commercial all day. It's now permanently stuck in your head.","You spotted a coin on the ground. As you bent over to pick it up, your pants ripped in the most conspicuous way possible. You were so flustered, you left the coin behind.","You're suddenly struck with the cold horror of not being 100% sure you locked your front door. You spend the next five seconds frantically replaying your morning in a high-stakes mental thriller.","Your phone suddenly decides to play a video from your gallery at full volume. It's the one of you singing terribly off-key in the car. Your darkest secret is now public.","You confidently stride forward, only to step directly into a puddle you didn't see. Your brand new shoe and sock are now enjoying an unsolicited mud spa.","A pigeon executed a precision bombing run on you. For the rest of your walk, you pretend the new splotch on your shoulder is an avant-garde fashion statement.","A wave of panic hits as you can't find your keys in your pocket. Your heart stops for a second... before you find them in your other pocket.","You bit into your emergency cookie with such enthusiasm that you also bit your own tongue. For a brief moment, you saw the entire color spectrum and tasted pure, self-inflicted betrayal.","With your headphones on, you started singing along to your music, completely lost in the moment. You were not alone...","You put your T-shirt on inside out this morning in a rush. You spent the entire day wondering why people were giving you funny looks and why the tag was so incredibly itchy.","You let out a yawn so massive your jaw popped and got stuck open for a second. In that moment, your life as a perpetually surprised goldfish flashed before your eyes.","The coffee machine dispensed a cup, then proceeded to pour the coffee directly next to it. You watched the hot stream disappear, feeling a deep and personal sense of betrayal.","You walked face-first into a spiderweb, sparking five minutes of frantic, flailing combat-dancing against an unseen, eight-legged foe.","You answered your phone with an energetic 'Hello?!' only to realize no one was calling. You'd just accidentally unlocked it with your face and now look like you're having a heated conversation with yourself."],eo=["Yes! This is exactly what I needed.","Victory is sweet! Literally.","Worth it. Every single cursed step.","I faced down fate and black cats for this. And I'd do it again.","Finally! My precious!","If I don't get some sugar, I might just jump out of this screen and slap you. You're lucky!","About time! My blood sugar was getting dangerously low.","This better be good. I went through heck for this donut.","Give it to me. The sugar cravings... they're getting stronger.","One more minute and I would not have been responsible for my actions.","Oh, look. A cake. All that for a piece of cake. Fantastic.","Well, that was an ordeal. This better have extra frosting.","I can't believe that actually worked. Now, where's the fork?","So, is this my reward for not being crushed by a meteor? I'll take it.","Task completed. Now initiating sugar consumption protocol.","Hello, beautiful. I've missed you.","The sight, the smell... the glorious taste awaits!","Time to ruin my dinner. And it feels so good.","I'm going to eat this so fast, you won't even see it happen."],ei={normal:["daniel","aaron"],meow:["superstar","samantha"],robot:["trinoids","zarvox"],robotSing:["organ"],soldier:["whisper"],laugh:["jester","wobble"],chiming:["bells"],bubbling:["bubbles"],sing:["cellos"],funeral:["bad"]},en=window.speechSynthesis;function er(e,t="normal",o=1,i=1,n=!1){let{controls:{sound:r}}=el;if(!r){let t=200*e.length;t<2e3&&(t=2e3),t>1e4&&(t=1e4),n&&(t+=5e3),d(e,n),p(t);return}let a=ei[t],s=es.find(e=>a.includes(e.name.toLocaleLowerCase().split(" ")[0]));if(!s&&"normal"!==t)return er(e,"normal");let c=new SpeechSynthesisUtterance(e);c.lang="en-US",s&&(c.lang=s.lang,c.voice=s),c.volume=o,c.rate=i,ea(),en.speak(c),d(e,n),c.onend=()=>p(n?5e3:2e3)}function ea(){en.cancel()}let es=[];function ec(){es=speechSynthesis.getVoices().filter(e=>e.localService&&e.lang.includes("en"))}speechSynthesis.onvoiceschanged=ec,ec();let el={controls:{music:!0,sound:!0},state:{type:"home",timeStart:Date.now()},score:{level:0,catastrophes:0}};function ed(e){let t=!el.controls[e];return el.controls[e]=t,"music"===e&&t&&J(),"sound"!==e||t||ea(),t}const ep=[];function eu(e){"game"===el.state.type&&(er(u(_[e]),"soldier",.6,1.2),ep.push(e))}function eh(){J();let{state:{type:e}}=el;switch(e){case"home":case"before":case"catastrophe":ey("cat");break;case"cat":case"game":break;case"end":ey("home")}}function ey(e,t){let o=m[el.score.level],i="game"===el.state.type?el.state.positionAfter:o.start;if("home"===e)el={...el,state:{type:"home",timeStart:Date.now()},score:{level:0,catastrophes:0}},r.innerHTML=`<h2>Cross the black cat's path and trigger a true Cat-astrophe!</h2>
<p><b>Your mission:</b> Get the candy! ${M}</p>
<p><b>Your obstacle:</b> One very unlucky black cat. \u{1F408}\u{200D}\u{2B1B}</p>
<p><i>Use the arrows (\u{2190} \u{2191} \u{2192} \u{2193}) to guide me.</i></p>
<p><b>Good luck! You're gonna need it. \u{1F609}</b></p>`,a.innerText="Begin the Madness!",r.className=a.className="",s.className="hide";else if("before"===e)el={...el,state:{type:"before",timeStart:Date.now()}},r.innerHTML=`<h2>Sweet Victory! ${M}</h2>
<p>You dodged disaster and secured the goods. You're a legend! \u{1F973}</p>
<p>But don't get too comfortable, the next level is waiting...</p>`,a.innerText="Bring it on! \uD83D\uDCAA",r.className=a.className="",s.className="hide";else if("cat"===e)el={...el,state:{type:e,timeStart:function(e=1){return(Math.floor(Date.now()/500/e)+1)*500*e}()}},r.className=a.className="hide",ea(),o.cats.forEach((e,t)=>setTimeout(X,1500*t/o.cats.length));else if("game"===e){if(!t)throw Error("map is undefined");el={...el,state:{type:"game",timeStart:Date.now(),positionBefore:o.start,positionAfter:o.start,map:t}},ep.splice(0,ep.length),r.className=a.className="hide",s.className="",B=u(q),er(u(ee),"soldier")}else"catastrophe"===e?(el={...el,state:{type:"catastrophe",position:i}},r.innerHTML=`<h2>CAT-ASTROPHE! \u{1F640}</h2>
<p>You crossed the path! Now suffer the comically bad luck.</p>
<p>Was it the cat? Or were you just that clumsy? \u{1F914}</p>`,a.innerText="Try Again! \uD83D\uDE20",r.className=a.className="",s.className="hide"):"end"===e&&(el={...el,state:{type:"end",position:i}},r.innerHTML=`<h2>You Survived! \u{1F3C6}</h2>
<p>You only triggered <b>${el.score.catastrophes} cat-astrophes!</b> Not bad... for you. \u{1F915}</p>
<p>You navigated the feline chaos and beat the odds.<br />You're officially the cat's pajamas! \u{1F63C}</p>
<p><b>Thanks for playing! Hope you had a blast. \u{1F4A5}</b></p>`,a.innerText="Play Again?",r.className=a.className="",s.className="hide")}let eg=0;M=u(E),ey("home"),function e(){!function(){let{state:e,score:t}=el,o=D();if(o<eg){let{cats:o,size:i,boxes:n,end:r}=m[t.level];if("cat"===e.type){let t=Array.from({length:i.y},()=>Array(i.x).fill(!1));o.every(o=>L(o,e.timeStart,i,n,t).isDone)&&ey("game",t)}else if("game"===e.type){let t=e.positionAfter;if(t.x===r.x&&t.y===r.y&&(el.score.level+1>=m.length?ey("end"):(el.score.level++,M=u(E),ey("before")),er(u(eo),"soldier")),e.map[t.y-1][t.x-1]){el.score.catastrophes++,ey("catastrophe"),er(u(et),"normal",1,1,!0);return}let o=ep[0];ep.shift(),e.positionBefore=e.positionAfter;let a=G(e.positionAfter,o);W(a,i)||j(a,n)||(e.positionAfter=a)}}eg=o;let i=m[t.level];n.innerText=`Level: ${t.level+1} / ${m.length}
Cat-astrophes: ${t.catastrophes}`;let r=window.devicePixelRatio||1,a=window.innerWidth,s=window.innerHeight;w.width=a*r,w.height=s*r,w.style.width=`${a}px`,w.style.height=`${s}px`,b.scale(r,r);let{size:c,start:l,end:d,boxes:p,cats:h}=i,y=T(c);(function(e,t){let o=Date.now();if((P=P.filter(e=>o<e.timeEnd+2e3)).length<7){let t=Math.random(),i=Math.random(),n=Math.random()/3+.1,r=Math.random()/2+.1,a=o+5e3+7e3*Math.random(),s=a+5e3+2e3*Math.random(),c=Math.random();c<.25?P.push({timeStart:a,timeEnd:s,sizeEyes:n,opacity:r,position:{x:e.x*t+1,y:i}}):c<.5?P.push({timeStart:a,timeEnd:s,sizeEyes:n,opacity:r,position:{x:e.x*t+1,y:e.y+i+1}}):c<.75?P.push({timeStart:a,timeEnd:s,sizeEyes:n,opacity:r,position:{x:t,y:e.y*i}}):P.push({timeStart:a,timeEnd:s,sizeEyes:n,opacity:r,position:{x:e.x+t+1,y:e.y*i+1}})}P.forEach(e=>N(e.position,e.sizeEyes,e.timeStart,e.timeEnd,e.opacity,t));let i=t.x(1),n=t.y(1),r=t.x(e.x+1)-t.x(1),a=t.y(e.y+1)-t.y(1),s=.4*t.squareSize,c=v(D(.05,0));b.fillStyle="#696f6f55",b.beginPath(),b.roundRect(i+30+5*c,n+30+5*c,r,a,s),b.fill();let l=v(D(.05,.2));b.fillStyle="#543b0e",b.beginPath(),b.roundRect(i+20+3*l,n+20+3*l,r,a,s),b.fill();let d=v(D(.05,.4));b.fillStyle="#674107",b.beginPath(),b.roundRect(i+10+2*d,n+10+2*d,r,a,s),b.fill(),b.fillStyle="#117c13",b.beginPath(),b.roundRect(i,n,r,a,s),b.fill(),b.save(),b.beginPath(),b.roundRect(i,n,r,a,s),b.clip();let p=t.squareSize/2,u=D(.03,0);b.translate(t.x(u*(e.x+3)),t.y(1)),b.strokeStyle="#138510",b.lineWidth=p,b.lineCap="square",b.beginPath(),b.moveTo(+p,0),b.bezierCurveTo(-1*p,t.y(.33*e.y),0*p,t.y(.66*e.y),-2*p,t.y(+e.y)),b.stroke(),b.restore(),b.strokeStyle="rgba(255, 255, 255, 0.15)",b.lineWidth=1;for(let o=2;o<=e.x;o++){let i=t.x(o);b.beginPath(),b.moveTo(i,t.y(1)),b.lineTo(i,t.y(e.y+1)),b.stroke()}for(let o=2;o<=e.y;o++){let i=t.y(o);b.beginPath(),b.moveTo(t.x(1),i),b.lineTo(t.x(e.x+1),i),b.stroke()}})(c,y),function(e,t){let o=t.x(e.x+.5),i=t.y(e.y+.7),n=v(D(.5))-.5;b.font=`${Math.floor(.5*t.squareSize)}px sans-serif`,b.textBaseline="middle",b.textAlign="center",b.fillText(M,o,i+n*t.squareSize*.1)}(d,y),p.forEach((e,t)=>(function(e,t,o=0){let i=t.x(e.x+.1),n=t.y(e.y+.2),r=.8*t.squareSize,a=.8*t.squareSize,s=.6*a,c=v(D(.5))-.5,l=v(D(.03));b.fillStyle="#111",b.beginPath(),b.rect(i,n+10,r,s),b.fill(),b.fillStyle="#C2B280",b.strokeStyle="#8B7355",b.lineWidth=2,b.beginPath(),b.moveTo(i,n+10+s),b.lineTo(i,n+10+s+.2*a),b.lineTo(i+r,n+10+s+.2*a),b.lineTo(i+r,n+10+s),b.closePath(),b.fill(),b.stroke(),b.beginPath(),b.moveTo(i,n+10),b.lineTo(i,n+10-.2*a),b.lineTo(i+r,n+10-.2*a),b.lineTo(i+r,n+10),b.closePath(),b.fill(),b.stroke(),b.beginPath(),b.moveTo(i,n+10),b.lineTo(i,n+10+s),b.lineTo(i-.2*s+c*s*.1,n+10+1.2*s),b.lineTo(i-.2*s+c*s*.1,n+10-.2*a+.2*s),b.closePath(),b.fill(),b.stroke(),b.beginPath(),b.moveTo(i+r,n+10),b.lineTo(i+r,n+10+s),b.lineTo(i+r+.2*s-c*s*.1,n+10+1.2*s),b.lineTo(i+r+.2*s-c*s*.1,n+10-.2*a+.2*s),b.closePath(),b.fill(),b.stroke(),F[o]||(F[o]={timeShow:5e3*Math.random()+5e3,opacity:.6*Math.random()+.3,size:.2*Math.random()+.05});let d=F[o];N({x:e.x+.5,y:e.y+.5},t.squareSize/100*d.size,d.timeShow,1e4,d.opacity,t,1e4*l)})(e,y,t)),"home"===e.type?(N({x:c.x/2+1,y:1},2,e.timeStart+4e3,0x9184e729fff,1,y),I(l,l,y),C(l,y)):"before"===e.type?(N({x:c.x/2+1,y:1},2,e.timeStart,0x9184e729fff,1,y),I(l,l,y),C(l,y)):"cat"===e.type?(N({x:c.x/2+1,y:1},2,0,e.timeStart,1,y),I(l,l,y),C(l,y),e.timeStart<=Date.now()&&h.forEach(t=>(function(e,t,o,i,n){var r,a;let{isDone:s,position:c,direction:l,state:d}=L(e,t,o,i);if(s)return;b.save();let p=v(D(1.5))-.5,u=n.squareSize;b.translate(n.x(c.x+.5),n.y(c.y+.5));let h=1;switch("jumpIn"===d&&(h=(r=D(1))<0?0:r>1?1:-4.375*r**2+5.375*r),"jumpOut"===d&&(h=(a=D(1))<0?1:a>1?0:-4.375*a**2+3.375*a+1),b.scale(h,h),l){case"down":b.rotate(0);break;case"up":b.rotate(Math.PI);break;case"right":b.rotate(-Math.PI/2);break;case"left":b.rotate(Math.PI/2)}b.translate(0,-u/2);let y=.4*u,g=.7*u,f=.15*u;b.fillStyle=e.color,b.strokeStyle=e.color,b.lineWidth=.6*f,b.lineCap="round","walk"===d?(b.beginPath(),b.moveTo(0-.3*f,g),b.lineTo(0-.3*f,g+f*(.7+.5*p)),b.stroke(),b.beginPath(),b.moveTo(0+.3*f,g),b.lineTo(0+.3*f,g+f*(.7-.5*p)),b.stroke(),b.beginPath(),b.moveTo(0-.3*f,y),b.lineTo(0-.3*f,y-f*(.3+.5*p)),b.stroke(),b.beginPath(),b.moveTo(0+.3*f,y),b.lineTo(0+.3*f,y-f*(.3-.5*p))):(b.beginPath(),b.moveTo(0-.3*f,g),b.lineTo(0-.3*f,g+1.2*f),b.stroke(),b.beginPath(),b.moveTo(0+.3*f,g),b.lineTo(0+.3*f,g+1.2*f),b.stroke(),b.beginPath(),b.moveTo(0-.3*f,y),b.lineTo(0-.3*f,y-.8*f),b.stroke(),b.beginPath(),b.moveTo(0+.3*f,y),b.lineTo(0+.3*f,y-.8*f)),b.stroke(),b.lineWidth=.2*f,b.beginPath(),b.moveTo(0,y),b.quadraticCurveTo(0-p*f*.4,.2*u,0,.1*u),b.stroke(),b.lineWidth=1.4*f,b.beginPath(),b.moveTo(0,y),b.quadraticCurveTo(0+p*f*.2,.5*u,0,g),b.stroke(),b.beginPath(),b.arc(0,g,f,0,2*Math.PI),b.fill();let x=b.createLinearGradient(0-.1*f,g+.1*f,0-.1*f,g-.4*f);e.color.includes("FF")||e.color.includes("F5")?(x.addColorStop(0,"rgba(0, 0, 0, 0.4)"),x.addColorStop(1,"rgba(0, 0, 0, 0.9)")):(x.addColorStop(0,"rgba(255, 255, 255, 0.4)"),x.addColorStop(1,"rgba(255, 255, 255, 0.9)")),b.strokeStyle=x,b.lineWidth=.01*u,b.beginPath(),b.moveTo(0-.1*f,g+.1*f),b.lineTo(0-.5*f,g-.4*f),b.lineTo(0-.8*f,g+.1*f),b.stroke(),b.beginPath(),b.moveTo(0+.1*f,g+.1*f),b.lineTo(0+.5*f,g-.4*f),b.lineTo(0+.8*f,g+.1*f),b.stroke(),b.restore()})(t,e.timeStart,c,p,y))):"game"===e.type?(I(e.positionBefore,e.positionAfter,y),C(l,y,e.timeStart)):"catastrophe"===e.type?(I(e.position,e.position,y),function(e,t){let o=t.x(e.x+.5),i=t.y(e.y+.5),n=v(D(.5))-.5;b.font=`${.8*t.squareSize}px sans - serif`,b.textBaseline="middle",b.textAlign="center",b.fillText(B,o,i+n*t.squareSize*.1)}(e.position,y)):I(e.position,e.position,y),"game"===e.type&&function(e,t){let o=e.map(e=>"up"===e?"↑":"down"===e?"↓":"left"===e?"←":"→"),i=T(t),n=i.x(1),r=i.y(t.y+1.1);b.font="18px sans-serif",b.textBaseline="top",b.textAlign="center",b.fillStyle="#AAA",b.fillText(o.join(" "),n,r)}(ep,i.size)}(),requestAnimationFrame(e)}();