var pt='<svg xmlns="http://www.w3.org/2000/svg" stroke="#000" stroke-width=".5" viewBox="0 0 512 512" width="64" height="64"><path d="M256 0c-82 0-148 66-148 148v67h296v-67C404 66 338 0 256 0z" style="fill:#5a4146"/><path d="m256 0-27 2c69 13 121 73 121 146v67h54v-67C404 66 338 0 256 0z" style="opacity:.1;enable-background:new"/><path d="M130 176c-20 0-37 16-37 36 0 21 17 37 37 37h17v-73h-17zM382 176c20 0 37 16 37 36 0 21-17 37-37 37h-17v-73h17z" style="fill:#e6b273"/><path d="M431 512c-20-48-58-86-107-105H188c-48 19-87 57-107 105h350z" style="fill:#6ab2cc"/><path d="M294 398v-68h-76v68c-11 2-20 5-30 9a70 70 0 0 0 136 0c-10-4-19-7-30-9z" style="fill:#f0c087"/><path d="M218 330v57a159 159 0 0 0 76 0v-57h-76z" style="opacity:.1;enable-background:new"/><path d="M347 117c-13 0-23-10-23-23a23 23 0 0 1-45 0 23 23 0 0 1-46 0 23 23 0 0 1-45 0 23 23 0 0 1-41 14c-11 18-17 39-17 61v64a126 126 0 0 0 252 0v-64c0-22-6-43-17-61-4 5-11 9-18 9z" style="fill:#f0c087"/><path d="M256 293c-15 0-28-2-35-7a8 8 0 0 1 9-14c4 3 13 5 26 5s22-2 26-5a8 8 0 0 1 9 14c-7 5-20 7-35 7zM175 194a8 8 0 0 1-6-14c7-5 18-8 31-8s23 3 30 8a8 8 0 0 1-11 13c-2-3-10-5-19-5s-18 2-20 5l-5 1z" style="fill:#5a4146"/><circle cx="199.6" cy="213.6" r="13.8" style="fill:#353640"/><path d="m337 194-5-1c-2-3-10-5-20-5-9 0-17 2-19 5a8 8 0 0 1-11-13c7-5 18-8 30-8 13 0 24 3 31 8a8 8 0 0 1-6 14z" style="fill:#5a4146"/><circle cx="312.4" cy="213.6" r="13.8" style="fill:#353640"/></svg>';var mt='<svg xmlns="http://www.w3.org/2000/svg" width="64" height="64"><path fill="#4c5359" d="M4.5 2.2c-3.5 2.2-3.4 25.5.8 33l26.1-16c-4-7.1-23.6-19-26.9-17"/><path fill="#f7a4a4" d="M9.5 11.3c-1.5.9-2.2 16.2.4 21l16.7-10.2c-2.4-4.6-15.7-11.6-17.1-10.8"/><path fill="#4c5359" d="M59.5 2.2c3.5 2.2 3.4 25.5-.7 33l-26.1-16c3.9-7.1 23.5-19 26.8-17"/><path fill="#f7a4a4" d="M54.5 11.3c1.5.9 2.2 16.2-.4 21L37.3 22.1c2.5-4.6 15.8-11.6 17.2-10.8"/><path fill="#4c5359" d="M31.8 13.1C4.7 13.1 2.2 32.5 2.2 43.5 2.2 48 15.4 62 31.8 62c16.4 0 29.6-14 29.6-18.5 0-11-2.5-30.4-29.6-30.4"/><path fill="#bfffab" d="M24.2 38.7s-3.1 4.8-8.8 3.3c-5.7-1.5-6-7.2-6-7.2s3.1-4.8 8.8-3.3a8 8 0 0 1 6 7.2"/><path fill="#93e67f" d="M23.6 36.2s-2.7 3-6.5 3c-4.1 0-6.5-5.9-6.5-5.9s2.7-3.1 7.6-1.9a7.3 7.3 0 0 1 5.4 4.8"/><path fill="#4c5359" d="M19.4 36.1c0 6.6-3.2 6.6-3.2 0 .1-6.6 3.2-6.6 3.2 0"/><path fill="#bfffab" d="M39.4 38.7s3.1 4.8 8.8 3.3c5.7-1.5 6-7.2 6-7.2s-3.1-4.8-8.8-3.3a8 8 0 0 0-6 7.2"/><path fill="#93e67f" d="M39.9 36.2s2.7 3 6.5 3c4.1 0 6.5-5.9 6.5-5.9s-2.7-3.1-7.6-1.9c-4.5 1.2-5.4 4.8-5.4 4.8"/><path fill="#4c5359" d="M44.1 36.1c0 6.6 3.2 6.6 3.2 0s-3.2-6.6-3.2 0"/><path fill="#fff" d="M40.4 44c-2.6-2-5.4-8.7-8.6-8.7S25.7 42 23.1 44c-4.1 3.2-15 6.8-15 6.8S19.7 61 31.7 61s23.6-10.2 23.6-10.2c.1 0-10.8-3.6-14.9-6.8"/><ellipse cx="31.8" cy="54.5" fill="#ff94a4" rx="1.7" ry="2.5"/><g fill="#4c5359"><path d="M40.2 53.1a6 6 0 0 1-3.1.8 5 5 0 0 1-2.9-1.1 4.2 4.2 0 0 1-1.6-2.6l-.8-4.5-.8 4.5c-.2 1-.8 1.9-1.6 2.6a5.2 5.2 0 0 1-6 .3 5 5 0 0 1-2.2-2.7 5.4 5.4 0 0 0 5.2 4.8c1.4.1 2.7-.3 3.8-1.1.6-.4 1.1-1 1.5-1.6a5.8 5.8 0 0 0 5.3 2.7c1.3-.1 2.6-.6 3.6-1.4 1-.9 1.7-2.1 1.7-3.4a4.7 4.7 0 0 1-2.1 2.7"/><path d="M35.8 44.8c-.8-1-3.3-1.1-4-1.1-.7 0-3.2.1-4 1.1-.6.7-.1 2.5 1.4 4 1 1 1.9 1.3 2.6 1.3.7 0 1.7-.3 2.6-1.3 1.5-1.6 2-3.3 1.4-4"/></g></svg>';zzfx=(...i)=>zzfxP(zzfxG(...i));zzfxP=(...i)=>{let t=zzfxX.createBufferSource(),e=zzfxX.createBuffer(i.length,i[0].length,zzfxR);return i.map((s,r)=>e.getChannelData(r).set(s)),t.buffer=e,t.connect(zzfxX.destination),t.start(),t};zzfxG=(i=1,t=.05,e=220,s=0,r=0,o=.1,n=0,c=1,a=0,f=0,h=0,u=0,d=0,w=0,R=0,W=0,p=0,T=1,z=0,H=0)=>{let m=2*Math.PI,B=a*=500*m/zzfxR**2,O=(0<R?1:-1)*m/4,L=e*=(1+2*t*Math.random()-t)*m/zzfxR,v=[],y=0,N=0,l=0,k=1,it=0,Pt=0,M=0,U,A;for(s=99+zzfxR*s,z*=zzfxR,r*=zzfxR,o*=zzfxR,p*=zzfxR,f*=500*m/zzfxR**3,R*=m/zzfxR,h*=m/zzfxR,u*=zzfxR,d=zzfxR*d|0,A=s+z+r+o+p|0;l<A;v[l++]=M)++Pt%(100*W|0)||(M=n?1<n?2<n?3<n?Math.sin((y%m)**3):Math.max(Math.min(Math.tan(y),1),-1):1-(2*y/m%2+2)%2:1-4*Math.abs(Math.round(y/m)-y/m):Math.sin(y),M=(d?1-H+H*Math.sin(2*Math.PI*l/d):1)*(0<M?1:-1)*Math.abs(M)**c*i*zzfxV*(l<s?l/s:l<s+z?1-(l-s)/z*(1-T):l<s+z+r?T:l<A-p?(A-l-p)/o*T:0),M=p?M/2+(p>l?0:(l<A-p?1:(A-l)/p)*v[l-p|0]/2):M),U=(e+=a+=f)*Math.sin(N*R-O),y+=U-U*w*(1-1e9*(Math.sin(l)+1)%2),N+=U-U*w*(1-1e9*(Math.sin(l)**2+1)%2),k&&++k>u&&(e+=h,L+=h,k=0),!d||++it%d||(e=L,a=B,k=k||1);return v};zzfxV=.1;zzfxR=44100;zzfxX=new(window.AudioContext||webkitAudioContext);zzfxM=(i,t,e,s=125)=>{let r,o,n,c,a,f,h,u,d,w,R,W,p,T,z,H=0,m=[],B=[],O=[],L=0,v=0,y=1,N={},l=zzfxR/s*60>>2;for(;y;L++)m=[y=u=R=p=0],e.map((k,it)=>{for(h=t[k][L]||[0,0,0],y|=!!t[k][L],z=p+(t[k][0].length-2-!u)*l,T=it==e.length-1,o=2,c=p;o<h.length+T;u=++o){for(a=h[o],d=o==h.length+T-1&&T||w!=(h[0]||0)|a|0,n=0;n<l&&u;n++>l-99&&d?W+=(W<1)/99:0)f=(1-W)*m[H++]/2||0,B[c]=(B[c]||0)-f*v+f,O[c]=(O[c++]||0)+f*v+f;a&&(W=a%1,v=h[1]||0,(a|=0)&&(m=N[[w=h[H=0]||0,a]]=N[[w,a]]||(r=[...i[w]],r[2]*=2**((a-12)/12),a>0?zzfxG(...r):[])))}p=z});return[B,O]};var xt=Array.from({length:25},(i,t)=>String.fromCharCode(65+t)),g,x,V=!0;function yt(){g=document.getElementsByTagName("canvas")[0],x=g.getContext("2d",{alpha:!1}),gt(x);let i=g.dataset.initWidth,t=g.dataset.initHeight;return window.addEventListener("blur",()=>V=!1),window.addEventListener("focus",()=>V=!0),window.addEventListener("resize",()=>gt()),{W:i,H:t}}function gt(){let i=window.devicePixelRatio,t=g.dataset.initWidth,e=g.dataset.initHeight;g.width=t*i,g.height=e*i,x.scale(i,i),g.style.width=t+"px",g.style.height=e+"px";let s=window.innerWidth/t,r=window.innerHeight/e,o=Math.min(s,r);g.style.transform=`scale(${o})`,g.dataset.scale=o}function C(i){switch(i){case"bomb":return"\u{1F4A3}";case"rocket":return"\u{1F680}";case"snowflake":return"\u2744"}}function J(i){let t=Math.floor(Math.random()*i.length);return i[t]}function _(i){return Math.random()<i}function rt(i){return new Promise((t,e)=>{let s=new Image;s.src="data:image/svg+xml;charset=utf-8;base64,"+btoa(i),s.onload=()=>t(s),s.onerror=e})}var b=new Set,ot=new Set;function K(){let i=!1,t=0,e=r=>{i&&(t>0?t-=r:(i=!1,b.delete(e)))},s=()=>t<=0;return{get isActive(){return i},get isTimeout(){return s()},get time(){return t},update(r){e(r)},start(r=0){t=r,i=!0,b.add(e)}}}function Q(i=0,t=()=>{}){let e=K(),s=r=>{e.update(r),e.isTimeout&&(b.delete(s),t())};e.start(i),b.add(s)}function nt(i=!1){let t=0,e=s=>{t+=s};return i&&b.add(e),{get now(){return t},get isPaused(){return!b.has(e)},stop(s=!1){b.delete(e),s&&(t=0)},start(){t=0,b.add(e)}}}function at(i,t,e){let s=r=>{r.save(),t(r),r.restore()};ot.add(s),Q(i,()=>{ot.delete(s),e&&e()})}function wt(i){for(let t of Array.from(b))t(i)}function kt(i){for(let t of Array.from(ot))t(i)}var tt=!1,bt="";function Tt(){let i=()=>{tt=!1},t=e=>{let s=e.ctrlKey||e.metaKey||e.shiftKey||e.altKey;!e.code.startsWith("Key")||s||(bt=e.code[3],tt=!0)};document.body.addEventListener("keyup",i),document.body.addEventListener("keydown",t)}function q(){return bt}function X(){let i=tt;return i&&(tt=!1),i}var D=class i{x;y;constructor(t=0,e=0){this.x=t,this.y=e}add(t){return typeof t=="number"?(this.x+=t,this.y+=t):(this.x+=t.x,this.y+=t.y),this}sub(t,e=t){return typeof t=="number"?(this.x-=t,this.y-=e):(this.x-=t.x,this.y-=t.y),this}mult(t){return this.x*=t,this.y*=t,this}div(t){return this.x/=t,this.y/=t,this}set(t=0,e=0){this.x=t,this.y=e}dist(t){return t.clone().sub(this).mag()}directionTo(t){return t.clone().sub(this).normalize()}lerp(t,e=1){this.x=(1-e)*this.x+e*t.x,this.y=(1-e)*this.y+e*t.y}normalize(){let t=this.mag();return t>0&&this.div(t),this}mag(){return Math.hypot(this.x,this.y)}clone(){return new i(this.x,this.y)}toString(){return`${this.x}, ${this.y}`}};var P=class{static name="Character";name="Character";ctx;img;width;halfWidth;pos=new D;letterIndex=0;isFrozen=!1;_score=0;constructor(t,e){this.ctx=t,this.img=e,this.width=this.img.width,this.halfWidth=this.width/2}set score(t){this._score=t,this._score<0&&(this._score=0)}get score(){return this._score}onRender(){this.ctx.drawImage(this.img,this.pos.x,this.pos.y)}};var F=class i extends P{static name="player";name=i.name};var $=class i extends P{static name="cat";name=i.name;predictTimer=K();level=0;_predictTimeSec=1;_predictChance=.5;_lastPredictResult=!1;constructor(t,e){super(t,e),this.levelUp([])}canPredict(){return this.predictTimer.isTimeout?(this.predictTimer.start(this._predictTimeSec),!0):!1}predict(){return!!_(this._predictChance)}onRoundStart(){this.predictTimer.start(this._predictTimeSec)}levelUp(t){this.level++,this._predictTimeSec=Math.max(.5,1-this.level*.08),this._predictChance=Math.min(.95,.5+this.level*.07);let e=t.filter(r=>r==="player").length,s=t.filter(r=>r==="cat").length;e===3?(this._predictTimeSec=Math.max(.3,this._predictTimeSec-.1),this._predictChance=Math.min(1,this._predictChance+.1)):s>=2&&(this._predictTimeSec=Math.min(2,this._predictTimeSec+.1),this._predictChance=Math.max(.3,this._predictChance-.1))}onRender(){if(super.onRender(),!this.predictTimer.isActive)return;this.ctx.strokeStyle="#444",this.ctx.lineWidth=1.3;let t=(this._predictTimeSec-this.predictTimer.time/this._predictTimeSec)*(Math.PI*2);this.ctx.beginPath(),this.ctx.arc(this.pos.x+this.halfWidth,this.pos.y+3,5,0,t),this.ctx.stroke()}};var E=class{ctx;width=0;height=0;char="";pos=new D;perk=this.getRandomPerk();isUsed=!1;_owners=new Set;isPlayerGuessedCorrect=null;constructor(t){this.ctx=t,this.char=J(xt),this.ctx.font="2rem monospace";let e=this.ctx.measureText(this.char);this.width=e.width,this.height=e.actualBoundingBoxAscent}addOwner(t,e){this._owners.add(t),t.name==="player"&&(this.isPlayerGuessedCorrect=e)}get owners(){return this._owners}get score(){return!this.perk||this.isUsed?1:this.perk==="bomb"?-1:this.perk==="rocket"?0:1}get color(){if(this.isPlayerGuessedCorrect===null)return"#444";if(this.isPlayerGuessedCorrect===!0)return"#688958";if(this.isPlayerGuessedCorrect===!1)return"#E87461"}getRandomPerk(){return _(.25)?"snowflake":_(.2)?"bomb":_(.1)?"rocket":!1}render(t){if(this.ctx.font="1rem monospace",this.ctx.lineWidth=2,this.ctx.strokeStyle=this.ctx.fillStyle=this.color,this.ctx.fillText(this.char,this.pos.x,this.pos.y),this.ctx.strokeRect(t.x,t.y,t.width,t.height),this._owners.size>0){let o=this.pos.y+16;for(let n of this._owners)this.ctx.drawImage(n.img,this.pos.x+2,o,16,16),o+=16*1.5}if(!this.perk||this.isUsed)return;let e=this.pos.x+this.width*.6,s=this.pos.y-this.height*.75;this.perk==="snowflake"&&(this.ctx.fillStyle="#EEE",this.ctx.lineWidth=1,this.ctx.strokeText(C(this.perk),e,s)),this.ctx.fillText(C(this.perk),e,s)}};var Y=class{ctx;letters=[];boundingRect=new DOMRect;centerX=0;totalSize=0;letterBoxPadding=10;letterPadding=5;letterMaxW=0;letterMaxH=0;letterTurnIdx=0;constructor(t,e,s){this.ctx=t,this.centerX=e,this.boundingRect.y=s}get head(){return this.letters[this.letterTurnIdx]}get size(){return this.letters.length}get isCompleted(){return this.letterTurnIdx>=this.letters.length}generate(t=1){this.letters=Array.from({length:t},()=>new E(this.ctx)),this.letterMaxW=Math.max(...this.letters.map(o=>o.width)),this.letterMaxH=Math.max(...this.letters.map(o=>o.height));let e=this.letterMaxW+this.letterPadding+this.letterBoxPadding;this.boundingRect.width=this.letters.reduce((o,n)=>o+n.width+e,0),this.boundingRect.height=this.letterMaxH,this.boundingRect.x=this.centerX-(this.boundingRect.width-e)/2;let s=this.letters.length,r=this.boundingRect.x;for(let o=0;o<s;o++){let n=this.letters[o];n.pos.set(r,this.boundingRect.y),r+=n.width+e}this.letterTurnIdx=0}popHead(){return this.letters[this.letterTurnIdx++]}clear(){this.letters=[]}onRender(){let t=this.letterBoxPadding;for(let e of this.letters){let s=new DOMRect(e.pos.x-t,e.pos.y-this.boundingRect.height-t,this.letterMaxW+t*2,this.letterMaxH+t*2);e.render(s)}}};var Lt=zzfxM([[1.8,0,72,,,.2,,4,-2,6,50,.15,,6],[,0,655,,,.09,3,1.65,,,,,.02,3.8,-.1,,.2],[1.2,0,23,,,.2,3,4,,,3,.9,.05],[1.5,0,740,,,.15,2,.2,-.1,-.15,9,.02,,.1,.12,,.06]],[[[3,-1,13,13,13,8,13,,,,,,,,,,,,11,11,11,6,11,,,,,,,,,,,,10,10,10,6,10,,,,,,,,,6,8,10,8,8,8,5,13,,8,8,8,5,13,,,,,,],[,1,25,,25,,,,,,,,,,,,,25,25,,25,,,,,,,25,,,25,,25,25,25,,25,,,,,,,,,,,25,25,25,25,,25,,,,,,,,,,,,,,],[2,-1,13,,25,,13,13,25,13,,13,25,13,13,13,25,,13,,25,,13,13,25,13,,13,25,13,13,13,,,13,,25,,13,13,25,13,,13,25,13,13,13,25,,13,,25,,13,13,25,13,,13,25,13,13,13,25,,]],[[3,-1,13,13,13,8,13,,,,,,,,,,,,11,11,11,6,11,,,,,,,,,,,,10,10,10,6,10,,,,,,,,,6,8,10,8,8,8,5,13,,8,8,8,5,13,8,8,8,5,13],[2,-1,13,,25,,13,13,25,13,,13,25,13,13,13,25,27,11,,23,,11,11,23,11,,11,23,11,11,11,23,22,18,,30,,18,18,30,18,,18,30,18,18,18,30,22,13,,25,,13,13,25,13,,13,25,13,13,13,25,,],[,1,25,,25,,,,,,,,,,,,,25,25,,25,,,,,,,,,,,,,,25,,25,,,,,,,,,,,25,25,25,25,,25,,,,,,,,,,,,,,],[1,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,13,13,13,13,13,13,13,13]],[[3,-1,13,13,13,8,13,,13,15,17,17,15,13,20,20,18,17,18,,,,17,,15,,,,17,,18,,22,22,22,,18,,,,25,25,25,,22,,,18,20,22,20,,,,,,,,,,,,,,,,],[2,-1,13,,25,,13,13,25,13,,13,25,13,13,13,25,27,11,,23,,11,11,23,11,,11,23,11,11,11,23,22,18,,30,,18,18,30,18,,18,30,18,18,18,30,22,13,,25,,13,13,25,13,,13,25,13,13,13,25,,],[,1,25,,,,,,25,25,,25,25,,,,,,25,,,,,,25,25,,25,25,,,,,,25,,,,,,25,25,,25,25,,,,,,25,,,,,,25,25,,25,25,,,,,,],[1,1,,,,,13,,,,,,,,13,,,,,,,,13,,,,,,,,13,,13,,,,,,13,,,,,,,,13,,,,,,,,13,,,,,,,,13,13,,13]],[[3,-1,13,,25,,13,13,25,13,,13,25,13,13,13,25,,11,,23,,11,11,23,11,,11,23,11,11,11,23,,10,,22,,10,10,22,10,,10,22,10,10,6,8,10,20,25,20,20,25,20,,20,25,20,20,20,25,,20,,],[2,-1,13,,25,,13,13,25,13,,13,25,13,13,13,25,,13,,25,,13,13,25,13,,13,25,13,13,13,25,,13,,25,,13,13,25,13,,13,25,13,13,13,25,,13,,25,,13,13,25,13,,13,25,13,13,13,25,,],[,1,25,,,,,,25,25,,25,25,,,,,,25,,,,,,25,25,,25,25,,,,,,25,,,,,,25,25,,25,25,,,,,,25,,,,,,25,25,,25,25,,,,,,],[1,1,,,,,13,,,,,,,,13,,,,,,,,13,,,,,,,,13,,13,,,,,,13,,,,,,,,13,,,,,,,,13,,,,,,,,13,13,,13]],[[3,-1,13,,,,,,8,,17,15,13,,17,15,13,,15,,,,10,13,15,10,13,15,10,13,15,10,13,15,12,,,,,,8,15,,,,,17,15,13,8,13,,,,,,10,8,,20,20,20,20,20,20,20],[2,-1,13,,25,,13,13,25,13,,13,25,13,13,13,25,,15,,27,,15,15,27,15,,15,27,15,15,15,27,32,20,,32,,20,20,32,20,,20,32,20,20,20,32,,13,,25,,13,13,25,20,,20,32,20,20,20,32,,],[,1,25,,,,,,25,25,,25,25,,,,,,25,,,,,,25,25,,25,25,,,,,,25,,,,,,25,25,,25,25,,,,,,25,,,,,,25,25,,25,25,,,,,,],[1,1,,,,,13,,,,,,,,13,,,,,,,,13,,,,,,,,13,,13,,,,,,13,,,,,,,,13,,,,,,,,13,,,,,,,,13,13,,13]],[[3,-1,13,,,,,,8,,17,,,,18,17,15,,18,,,,13,,,,10,,,,6,,,,8,12,15,12,20,,8,12,15,12,20,,22,20,15,,13,,,,,,10,,8,,,,,8,20,8],[2,-1,13,,25,25,13,,25,25,13,,25,25,13,,25,25,15,,27,27,15,,27,27,15,,27,27,15,,27,27,20,,32,32,20,,32,32,20,,32,32,20,,32,32,13,,25,25,13,,25,25,20,,32,32,20,,32,34],[,1,25,,,,,,25,25,,25,25,,,,,,25,,,,,,25,25,,25,25,,,,,,25,,,,,,25,25,,25,25,,,,,,25,,,,,,25,25,,25,25,,,,,,],[1,1,,,,,13,,,,,,,,13,,,,,,,,13,,,,,,,,13,,13,,,,,,13,,,,,,,,13,,,,,,,,13,,,,,,,,13,13,,13]],[[3,-1,13,,,,,,8,,17,,,,18,17,15,,18,,,,13,,,,10,,,,6,,,,8,12,15,12,20,,8,12,15,12,20,,22,20,15,,13,,,,,,10,,8,,,,,8,20,8],[,1,25,,,,,,25,25,,25,25,,,,,,25,,,,,,25,25,,25,25,,,,,,25,,,,,,25,25,,25,25,,,,,,25,,,,,,25,25,,25,25,,,,,,],[1,1,,,,,13,,,,,,,,13,,,,,,,,13,,,,,,,,13,,13,,,,,,13,,,,,,,,13,,,,,,,,13,,,,,,,,13,13,,13]],[[,1,25,,,,,,25,25,,25,25,,,,,,25,,,,,,25,25,,25,25,,,,,,25,,,,,,25,25,,25,25,,,,,,25,,,,25,,,25,,,,25,25,25,25,25],[1,1,,,,,13,,,,,,,,13,,,,,,,,13,,,,,,,,13,,13,,,,,,13,,,,,,,,13,,,,,,,,13,13,,13,,13,13,13,13,13,13,13]]],[0,1,2,2,3,3,2,2,4,4,5,6,6,7,2,2,3],void 0,{title:"I am back",notes:"MOD pattern data for the song 'I am back', by Sky"}),ht={bomb:[,,333,.01,0,.9,4,1.9,,,,,,.5,,.6],pickup:[3.5,,331,.01,.07,.07,1,.7,,,261,.07,,,,,,.67,.03,,542],falsepickup:[2,,251,.01,.05,,1,.7,.2,,50,,,.9,,.4,,.4,.08,,-1532],catpickup:[2,,447,.01,.01,.08,1,1.1,,-4,,,,,,,,.6,.04],rocket:[2.7,,541,.04,.22,.19,1,.9,-9,,,,,,,,,.52,.11,,898],snowflake:[1.1,,585,,.15,.29,1,.5,-5,333,312,.07,.18,,,,,.52,.23,.15],touch:[8,,150,.01,,.03,1,4.2,,,,,,.5,,,,.93,,.1]},ct=!1;for(let[i,t]of Object.entries(ht))ht[i]=zzfxG(...t);function S(i,t=!1){let e=null;return i==="bgmusic"?e=zzfxP(...Lt):e=zzfxP(ht[i.toLowerCase()]),e&&t&&(e.loop=!0),{stop(){e.stop()},start(){e.start()}}}function et(){return ct}function zt(){ct=!ct}var lt=new Map;lt.set("player",{score:0,correct:0,scoreSize:0,passedLetters:0});lt.set("cat",{score:0,scoreSize:0});function I(i){return lt.get(i)}var j=class{ctx;W;H;BLOCK_WIDTH=.2;BLOCK_HEIGHT=.4;MAX_ROUND_SIZE=3;ROUND_COMPLETE_BREAK_SEC=3;letterSequence;player;cat;dialog;roundCompletedTimer=K();roundTime=nt();roundData=[];levelTime=nt();roundWinner=null;round=0;timeoutWarLetters=[];constructor(t,e,s){this.ctx=t,this.W=e,this.H=s,this.letterSequence=new Y(this.ctx,this.W*.5,this.H*.25),requestAnimationFrame(()=>this.updateScore())}get level(){return this.cat.level}get levelLetterSize(){return Math.max(2,Math.min(this.level+1,10))}get isRoundCompleted(){return!this.isLetterRemain(this.player)&&!this.isLetterRemain(this.cat)}onUpdate(t){if(!this.dialog.isOpen&&(this.isRoundCompleted?this.clearStage(t):this.checkLetterPredicted(),this.timeoutWarLetters.length>0&&this.manageRocketAttack(t),this.roundCompletedTimer.isActive)){if(this.roundCompletedTimer.time>2||this.timeoutWarLetters.length>0)return;if(this.roundCompletedTimer.time<1){this.timeoutWarLetters.length>0&&(this.timeoutWarLetters=[]);return}this.addRocket()}}addRocket(){let t=new E(this.ctx);t.perk=J(["rocket","snowflake","bomb"]),t.pos.set(this.cat.pos.x,this.cat.pos.y+32),this.timeoutWarLetters.push(t)}manageRocketAttack(t){for(let e of this.timeoutWarLetters){if(e.isUsed)continue;e.pos.dist(this.player.pos)<this.player.width&&(this.pickLetter(this.cat,e,!0),e.isUsed=!0),X()&&this.pickLetter(this.player,e,q()===e.char),e.pos.lerp(this.player.pos,1*t)}}checkLetterPredicted(){let t=this.letterSequence.letters,e=null,s=!1,r=null;this.isLetterRemain(this.player)&&X()&&!this.player.isFrozen?(r=this.player,e=t[r.letterIndex],s=e.char===q()):this.isLetterRemain(this.cat)&&this.roundTime.now>1&&!this.cat.isFrozen&&this.cat.canPredict()&&(r=this.cat,e=t[r.letterIndex],s=this.cat.predict()),r&&this.pickLetter(r,e,s)}pickLetter(t,e,s){if(e.addOwner(t,s),t.letterIndex++,t.name==="player"){let r=I("player");r.passedLetters++,s&&r.correct++,S(s?"pickUp":"falsePickUp")}else S("catPickUp");if(s){if(t.score+=e.score,!e.perk||e.isUsed){this.updateScore();return}this.activatePerk(e,t)}}isLetterRemain(t){return t.letterIndex<this.letterSequence.size}activatePerk(t,e){let s=e.pos.x,r=e.pos.y;switch(t.isUsed=!0,t.perk){case"bomb":s+=35,r*=1.85;break;case"rocket":e=e===this.player?this.cat:this.player;break;case"snowflake":e.isFrozen=!0,s+=e.halfWidth,r+=e.halfWidth;break}switch(t.perk!=="bomb"&&Q(1,()=>S(t.perk)),t.perk){case"bomb":case"snowflake":let o=t.pos.x+t.width*.6,n=t.pos.y-t.height*.75,c=1;at(2,h=>{h.font=c+"rem monospace",t.perk==="snowflake"&&(h.fillStyle="#EEE",h.strokeStyle="#444",h.lineWidth=1,h.strokeText(C(t.perk),o,n)),h.fillText(C(t.perk),o,n),c+=.04},()=>{e.isFrozen=!1,this.updateScore(),t.perk==="bomb"&&S(t.perk)});break;case"rocket":let a=t.pos.clone(),f=e.pos.clone().add(e.halfWidth);at(2,h=>{if(a.dist(f)<10)return;let d=a.directionTo(f).mult(300*.016);a.add(d),h.font="2rem roboto",h.fillText(C(t.perk),a.x,a.y)},()=>{e.score--,this.updateScore()});break}}clearStage(){this.roundTime.stop(),this.roundCompletedTimer.isActive?this.roundCompletedTimer.isTimeout?this.onStartRound():this.roundCompletedTimer.time<this.ROUND_COMPLETE_BREAK_SEC-2&&this.letterSequence.clear():this.onEndRound()}onEndRound(){this.round>this.MAX_ROUND_SIZE-1?(Q(2,this.onLevelUp.bind(this)),this.round=0):this.roundCompletedTimer.start(this.ROUND_COMPLETE_BREAK_SEC);let t=this.letterSequence.letters[this.letterSequence.size-1];if(!t)return;let e=Array.from(t.owners.values())[0];this.roundData.length<this.MAX_ROUND_SIZE&&this.roundData.push(e.name),this.letterSequence.letters.reduce((o,n)=>{let c=e.name==="player"?n.isPlayerGuessedCorrect:!n.isPlayerGuessedCorrect;return o+=c?1:0,o},0)>=Math.floor(this.levelLetterSize/2)&&(this.roundWinner=e)}onStartRound(){let t=this.levelLetterSize;this.letterSequence.generate(t),this.roundWinner&&(this.roundWinner.score+=Math.floor(t/2),this.roundWinner=null,this.updateScore()),this.round===0&&this.levelTime.start(),this.round++,this.player.letterIndex=this.cat.letterIndex=0,this.timeoutWarLetters=[],this.cat.onRoundStart(),this.roundTime.start()}updateScore(){for(let t of[this.player,this.cat]){let e=t.name;this.ctx.font="1.2rem monospace",I(e).score=t.score,I(e).scoreSize=this.ctx.measureText(t.score).width}}onLevelUp(){this.levelTime.stop(!0),this.cat.levelUp(this.roundData),this.dialog.show(this.level),this.roundData=[],this.letterSequence.clear()}addBlock(t,e){let s=this.H*.5,r=this.W*this.BLOCK_WIDTH,o=this.H-this.H*this.BLOCK_HEIGHT,n=I(e),c=t-n.scoreSize/2+r/2;this.ctx.fillStyle="#CFAB8D",this.ctx.fillRect(t,s,r,o),this.ctx.fillStyle="#222",this.ctx.font="1.2rem monospace",this.ctx.fillText(n.score,c,s+o/2),this.ctx.fillStyle="#ECEEDF",this.ctx.fillRect(t,s,r,o*.15)}onRender(){this.ctx.fillStyle="#D9C4B0",this.ctx.fillRect(0,0,this.W,this.H),this.ctx.fillStyle="#444",this.ctx.textAlign="center",this.roundCompletedTimer.isActive&&this.roundCompletedTimer.time>0&&(this.ctx.font="1rem monospace",this.ctx.fillText("Ready: "+(this.roundCompletedTimer.time+1|0),this.W*.5,60)),this.ctx.font="1rem monospace",this.ctx.fillText(this.levelTime.now|0,this.W*.5,25),this.ctx.textAlign="left",this.ctx.fillText("Level: "+this.level,10,25),this.ctx.font="0.75rem monospace",this.ctx.fillText(`Round: ${this.round}/${this.MAX_ROUND_SIZE}`,10,45);let t=this.W*.15,e=this.W*this.BLOCK_WIDTH/2;this.addBlock(t,this.player.name),this.player.pos.set(t+e-this.player.halfWidth,this.H*.5-this.player.halfWidth);let s=this.W*.15+this.W*.5,r=this.W*this.BLOCK_WIDTH/2;if(this.addBlock(s,this.cat.name),this.cat.pos.set(s+r-this.cat.halfWidth,this.H*.5-this.cat.halfWidth),this.roundWinner!==null){let u=this.roundWinner.pos.clone(),d=Math.floor(this.levelLetterSize/2);this.ctx.font="1rem monospace",this.ctx.fillStyle="#444",this.ctx.fillText(`+${d}`,u.x,u.y)}this.letterSequence.onRender();for(let u of this.timeoutWarLetters){let d=this.letterSequence.letterBoxPadding,w=u.height+d*2,R=new DOMRect(u.pos.x-d,u.pos.y-(w-d),u.width+d*2,w);u.render(R)}if(!this.isLetterRemain(this.player))return;let o=this.letterSequence.letterPadding+this.letterSequence.letterBoxPadding+this.ctx.lineWidth,n=this.letterSequence.letters[this.player.letterIndex].width+o,c=this.letterSequence.boundingRect.x-o*.5+(n+o)*this.player.letterIndex,a=this.letterSequence.boundingRect.y+this.letterSequence.boundingRect.height*1.5,f=c+n*.5,h=8;this.ctx.fillStyle="#444",this.ctx.beginPath(),this.ctx.moveTo(f,a),this.ctx.lineTo(f-h,a+h),this.ctx.lineTo(f+h,a+h),this.ctx.fill()}};var Mt=new Path2D("M3 9h4l5-5v16l-5-5H3z"),St=new Path2D("M3 9h4l5-5v16l-5-5H3zm13.59 3L14 9.41L15.41 8L18 10.59L20.59 8L22 9.41L19.41 12L22 14.59L20.59 16L18 13.41L15.41 16L14 14.59z");var dt=[{title:"Welcome to The Research",level:1,contents:["Thank you for agreeing to participate in the speed-typing challenge",`between a cat and a human.
`,"Press the letter shown on the screen; regular letters earn 1 point.","Some letters have unique abilities and are triggered only once. You",`earn points for each correct letter.
`,"Some letters have abilities:","\u{1F4A3}: You lose 1 point.","\u{1F680}: You don\u2019t gain a point, but your opponent loses 1 point.","\u2744 : You get 1 point, but you freeze for 2 seconds."]},{title:"Great Results!",level:2,contents:[`See? I told you it\u2019d be easy.
`,"When you complete level 10, the research will be finished.","Each level consists of 5 rounds and the number of letters increases",`with each level.
`,"To find out which letter the opponent is on, look below the letter.","If the ability in the letter has not disappeared, your opponent has",`pressed the wrong key on the keyboard.
`,"Maybe the cat did it on purpose; it's a good idea to","press the wrong key when it sees a letter with a bomb on the screen."]},{title:"Antics",level:3,contents:["Cat Appears to Be Having Trouble Finding the Letters.","But it seems to be thinking faster and pressing the right keys",`more and more.
`,"If you finish the round the fastest and get at least half of the letters","correct, you get extra points equal to half of the letters on the screen."]},{title:"Furrowed Brows",level:4,contents:["The cat looks focused \u2014 or is it devising a strategy?",`We apologize for the words thrown by the cat.
`,"How do you like our technology that shows a cat's thinking time?","When the thinking time is over, it tries to press the key,",`but there is no guarantee that it is the right key.
`,"(We had chosen a black cat to bring bad luck, but I guess the rumor is","false.)"]},{title:"Indigestion",level:5,contents:["The cat just climbed onto the keyboard... Could this work?","Was this its secret plan?"]},{title:"Purrfect",level:6,contents:[`The cat seems to be getting the hang of this.
`,"The cat's typing speed and accuracy keep increasing.",`Score as many points as you can before the cat gets stronger.
`,"Good luck!"]},{title:"You Got Very Close",level:7,contents:["Most of the level is done. There's no time to rest.","Can you grasp how important this research is?"]},{title:"You Can't Catch This Cat",level:8,contents:["The cat's out of control! It's starting to emit a noticeable heat","that scares us. Anyway, you must finish this."]},{title:"Nap? Not Today!",level:9,contents:["The cat isn't just breaking records in typing speed and accuracy","it's also setting records for not taking naps over a long time."]},{title:"The Final",level:10,contents:[`Use all your strength \u2014 this is the final stage.
`,"You\u2019ll see your progress after you pass this level."]},{title:"Results",level:11,contents:["Thank you for your participation,","The research results are quite usele... I mean, useful."]}];var Z=class{PADDING=30;LINE_PADDING=15;isOpen=!1;msg=dt[0];gameMusic=null;constructor(){this.isOpen=!0}show(t){this.msg=dt[t-1],this.msg.level===11&&this.msg.contents.push(...this.generateGameResult()),this.isOpen=!0}hide(){this.isOpen=!1,this.playGameMusic()}playGameMusic(){!this.gameMusic&&!et()?this.gameMusic=S("bgmusic",!0):this.gameMusic&&et()&&(this.gameMusic.stop(),this.gameMusic=null)}generateGameResult(){let t=[`
`,"Statistics:"],e=I("player"),s=(performance.now()/1e3/60).toFixed(1),r=e.passedLetters,o=e.correct,n=r-o;return t.push(`Playing time: ${s} minutes.`),t.push(`Your score: ${e.score}`),t.push(`Number of keys pressed: ${r}`),t.push(`Number of keys pressed correctly: ${o}`),t.push(`Number of keys pressed incorrectly: ${n}
`),t.push(`Don't forget to share your score: ${e.score} (${o}/${n}/${r})`),t}onRender(t,e,s){let r=s-this.PADDING*2;t.fillStyle="rgba(217, 196, 176, 0.5)",t.fillRect(0,0,e,s),t.fillStyle="#A26769",t.fillRect(this.PADDING,this.PADDING,e-this.PADDING*2,r),t.save(),t.font="0.5rem monospace",t.fillStyle="#444",t.translate(e-this.PADDING*1.75,5),t.fill(et()?St:Mt),t.fillText("Toggle Game Music (press M key):",-160,15),t.restore(),t.font="1.5rem monospace",t.fillStyle="#ECE2D0",t.fillText(this.msg.title,this.PADDING*1.5,this.PADDING*2.5),t.font="0.9rem monospace";let o=e-this.PADDING*4,n=this.PADDING*4;for(let c=0;c<this.msg.contents.length;c++){let a=this.msg.contents[c];t.fillText(a,this.PADDING*1.5,n,o),n+=t.measureText(a).actualBoundingBoxAscent+this.LINE_PADDING,a.endsWith(`
`)&&(n+=this.LINE_PADDING)}if(this.msg.level!==11&&(t.font="italic 0.7rem monospace",t.textAlign="right",t.fillText("[Press j to continue]",o+this.PADDING*2,r,o),!!X()))switch(S("touch"),q()){case"J":this.hide();break;case"M":zt(),this.playGameMusic();break}}};var{W:vt,H:Ct}=yt(),Rt=performance.now(),G,ut,ft,st;window.onload=async function(){let t=await rt(pt),e=await rt(mt);Tt(),ut=new F(x,t),ft=new $(x,e),st=new Z,G=new j(x,vt,Ct),G.player=ut,G.cat=ft,G.dialog=st,g.focus(),requestAnimationFrame(Dt)};function Dt(i){let e=(i-Rt)/1e3;Rt=i,V&&(_t(e),Et()),requestAnimationFrame(Dt)}function _t(i){wt(i),G.onUpdate(i)}function Et(){x.save(),x.shadowColor="rgba(0, 0, 0, 0.1)",x.shadowOffsetX=-4,x.shadowOffsetY=4,G.onRender(),ut.onRender(),ft.onRender(),st.isOpen&&st.onRender(x,vt,Ct),kt(x),x.restore()}
//! ZzFXM (v2.0.3) | (C) Keith Clark | MIT | https://github.com/keithclark/ZzFXM
